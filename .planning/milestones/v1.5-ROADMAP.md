# Milestone v1.5: Localization

**Status:** âœ… SHIPPED 2026-02-12
**Phases:** 29-32
**Total Plans:** 13

## Overview

Complete English and Spanish localization with instant language switching. Enables users to use the app in their preferred language with device detection, server-synced preferences, and localized push notifications.

## Phases

### Phase 29: Foundation & Tooling
**Goal**: Database schema, i18n configuration, automated tooling, and local persistence infrastructure
**Depends on**: Phase 28
**Requirements**: INFRA-01, INFRA-02, INFRA-03, PERS-01
**Success Criteria** (what must be TRUE):
  1. App detects device language on first launch using expo-localization
  2. App falls back to English when device language is not supported
  3. Translation keys have TypeScript autocomplete and compile-time validation
  4. User's language preference persists locally across app restarts via AsyncStorage
  5. i18next configured with proper fallback, error logging, and instant re-rendering on language change
**Plans**: 2 plans

Plans:
- [x] 29-01-PLAN.md -- Install i18n dependencies, create i18next config with device detection and TypeScript types
- [x] 29-02-PLAN.md -- Language service layer and useLanguage hook for local persistence

### Phase 30: Server Integration & Translation Files
**Goal**: Server-side language preference, notification translations, and complete English/Spanish translation files
**Depends on**: Phase 29
**Requirements**: PERS-02, PERS-03, NOTIF-01, NOTIF-02, TRANS-04, TRANS-05
**Success Criteria** (what must be TRUE):
  1. User's language preference syncs to Supabase profiles table
  2. Language preference syncs across user's devices (login on new device loads server preference)
  3. Push notifications are sent in user's preferred language via Edge Function
  4. All notification types have English and Spanish templates in database
  5. English translation file contains all ~400 app strings with proper namespacing
  6. Spanish translation file contains all ~400 app strings with professional translations
**Plans**: 6 plans (4 + 2 gap closure)

Plans:
- [x] 30-01-PLAN.md -- Database migration: users.preferred_language column and notification_translations table with seed data
- [x] 30-02-PLAN.md -- Language service server sync: extend lib/language.ts with Supabase sync
- [x] 30-03-PLAN.md -- Edge Function localization: enhance push/index.ts for localized notifications
- [x] 30-04-PLAN.md -- Complete translation files: EN/ES ~400 keys organized by namespace
- [x] 30-05-PLAN.md -- Gap closure: Wire useLanguage hook integration with auth session (PERS-03)
- [x] 30-06-PLAN.md -- Gap closure: Complete translation coverage (~114 additional keys)

### Phase 31: Root Integration & Settings UI
**Goal**: I18nProvider wrapping app, language selector in profile settings with instant switching
**Depends on**: Phase 30
**Requirements**: SETT-01, SETT-02
**Success Criteria** (what must be TRUE):
  1. User can navigate to language settings from profile settings screen
  2. User can select English or Spanish from language picker
  3. Language change takes effect instantly without app restart
  4. Selected language displays correctly in settings UI
  5. Language change syncs to both AsyncStorage and Supabase
**Plans**: 1 plan

Plans:
- [x] 31-01-PLAN.md -- Language settings screen with radio card UI and profile navigation link

### Phase 32: UI Component Migration
**Goal**: All UI strings translated across 93+ files with localized date/time formatting
**Depends on**: Phase 31
**Requirements**: TRANS-01, TRANS-02, TRANS-03
**Success Criteria** (what must be TRUE):
  1. All UI text (buttons, labels, headings, placeholders) displays in selected language
  2. All system messages (alerts, toasts, errors) display in selected language
  3. Date and time displays are localized (e.g., "11 de febrero" in Spanish)
  4. Tab labels, navigation titles, and screen headers update on language change
  5. No hardcoded strings remain in JSX (verified via eslint-plugin-i18next)
**Plans**: 13 plans (executed via consolidated approach - 4 summaries)

Plans:
- [x] 32-01-PLAN.md -- Create useLocalizedFormat hook and configure eslint-plugin-i18next
- [x] 32-02 through 32-10 -- Screen and component migrations (consolidated execution)
- [x] 32-11-PLAN.md -- Migrate notes, friends, calendar, and UI components
- [x] 32-12-PLAN.md -- Update countdown.ts and deviceCalendar.ts utilities
- [x] 32-13-PLAN.md -- Final ESLint verification and visual checkpoint

---

## Milestone Summary

**Key Decisions:**
- i18next + react-i18next + expo-localization stack (Expo official recommendation)
- Three-tier language preference hierarchy: Server > Local > Device
- Server-side language storage enables Edge Function push notification localization
- `notification_translations` table for all notification type templates
- TypeScript-safe translation keys via module augmentation
- Neutral Latin American Spanish for initial release
- Store preferred_language in users table (not auth metadata) for Edge Function service role access
- Single 'translation' namespace with nested JSON structure

**Issues Resolved:**
- ESLint v8 required for .eslintrc.js compatibility with Expo config
- useLanguage hook wiring with auth session for cross-device sync
- Missing expo-localization native module handled gracefully

**Technical Debt Incurred:**
- Human verification of localization pending (automated verification passed)
- Some dynamic key usage patterns show TypeScript warnings (acceptable for dynamic translations)

---

*For current project status, see .planning/PROJECT.md*
