# Milestone v1.0: MVP

**Status:** ✅ SHIPPED 2026-02-02
**Phases:** 1-5
**Total Plans:** 10

## Overview

This roadmap delivers coordinated birthday gifting through five phases: first establishing the notification infrastructure and user profiles with birthdays, then building the celebration coordination system with secret chat, followed by calendar integration for birthday visibility, enabling smart reminder sequences, and finally fixing integration issues for E2E testing. The strict dependency chain ensures each phase builds on a working foundation.

## Phases

### Phase 1: Foundation

**Goal**: Users can register push notifications and complete onboarding with their birthday and profile information
**Depends on**: Nothing (first phase)
**Plans**: 2 plans

Plans:
- [x] 01-01-PLAN.md — Notification infrastructure (database, push token registration, Edge Function)
- [x] 01-02-PLAN.md — Onboarding flow, profile screens, notification inbox

**Details:**
- Created device_tokens and user_notifications tables with RLS
- Built usePushNotifications hook with Expo Push Notifications
- Created Supabase Edge Function for push delivery
- Implemented blocking onboarding flow with avatar upload
- Built notification inbox with FlashList and realtime updates
- Created profile viewing screen

### Phase 2: Celebrations & Coordination

**Goal**: Users can coordinate gifts through secret chat rooms with an assigned Gift Leader per celebration
**Depends on**: Phase 1 (requires birthday data for rotation, notifications for alerts)
**Plans**: 2 plans

Plans:
- [x] 02-01-PLAN.md — Celebrations database schema, Gift Leader assignment, celebration screens
- [x] 02-02-PLAN.md — Real-time secret chat, contribution tracking, integration

**Details:**
- Created celebrations, chat_rooms, chat_messages, celebration_contributions tables
- Implemented RLS-enforced celebrant exclusion (security-critical)
- Built birthday rotation algorithm for Gift Leader assignment
- Created celebrations list and detail screens
- Implemented real-time chat with wishlist item linking
- Built contribution tracking with progress display

### Phase 3: Calendar

**Goal**: Users can view birthdays in an in-app calendar and sync events to their device calendar
**Depends on**: Phase 1 (requires birthday data)
**Plans**: 2 plans

Plans:
- [x] 03-01-PLAN.md — In-app calendar with birthday marking and countdown display
- [x] 03-02-PLAN.md — Device calendar sync and auto-celebration creation

**Details:**
- Installed react-native-calendars with multi-dot marking per group
- Created BirthdayCalendar component with 8-color group palette
- Built CountdownCard with urgency coloring (red/orange/blue/gray)
- Implemented device calendar sync with expo-calendar
- Created dedicated "Wishlist Birthdays" calendar on device
- Added pg_cron job for auto-celebration creation (30-day window)

### Phase 4: Smart Reminders

**Goal**: Users receive timely birthday reminders and Gift Leaders are notified when assigned
**Depends on**: Phase 1 (notification infrastructure), Phase 2 (Gift Leader assignment)
**Plans**: 3 plans

Plans:
- [x] 04-01-PLAN.md — Birthday reminder scheduling (pg_cron job, timezone support, muting)
- [x] 04-02-PLAN.md — Gift Leader assignment notifications (trigger, rich push content)
- [x] 04-03-PLAN.md — Gap closure: same-day batching and new member catch-up

**Details:**
- Created process_birthday_reminders() function with 4w/2w/1w/day_of reminders
- Implemented 9:00 AM local time delivery using AT TIME ZONE
- Built reminder_sent deduplication with UNIQUE constraint
- Added celebrant exclusion (gets only happy_birthday on day-of)
- Created Gift Leader 1-week nudge with contribution progress
- Implemented automatic timezone detection via Intl API
- Built Gift Leader assignment notification trigger
- Added same-day birthday batching (1=standard, 2="X and Y", 3+="N birthdays")
- Implemented new member catch-up for late joiners

### Phase 5: Integration Fixes

**Goal**: Fix schema mismatch and document webhook configuration to enable full E2E notification flows
**Depends on**: Phase 1 (fixes issues in notification infrastructure)
**Gap Closure**: Closes gaps from v1 milestone audit
**Plans**: 1 plan

Plans:
- [x] 05-01-PLAN.md — Schema migration (is_read → read_at) + webhook documentation

**Details:**
- Created migration to fix is_read BOOLEAN → read_at TIMESTAMPTZ mismatch
- Created 224-line WEBHOOK-SETUP.md with Dashboard configuration guide
- Verified TypeScript types already matched expected schema

---

## Milestone Summary

**Key Decisions:**

- Birthday rotation uses month-day sort with user_id tiebreaker for deterministic Gift Leader assignment
- Celebrant exclusion enforced at RLS level, not UI (security-critical)
- 15-minute cron interval for timezone coverage targeting 9:00 AM local delivery
- Nullable TIMESTAMPTZ for read_at instead of boolean for richer read state info

**Issues Resolved:**

- Schema mismatch between migration (is_read) and code (read_at) — fixed via migration
- Webhook not documented — created comprehensive setup guide
- Same-day birthday batching — implemented grouped notifications
- New member catch-up for late joiners — implemented single appropriate reminder

**Issues Deferred:**

- Profile editing after onboarding (v2)
- Notification preferences (v2)
- Chat read receipts and reactions (v2)
- Gift Leader progress dashboard (v2)

**Technical Debt Incurred:**

- npm --legacy-peer-deps required for React 19 compatibility with react-native-calendars
- Minor FlashList TypeScript type definition issue (non-blocking, runtime works)
- Pre-existing TypeScript errors in type exports (unrelated to v1 work)
- TODO comment in notifications.tsx for navigation routing (future enhancement)

---

_For current project status, see .planning/PROJECT.md_
_Archived: 2026-02-02 as part of v1.0 milestone completion_
