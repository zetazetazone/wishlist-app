---
phase: 33-foundation-feature-inventory
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - components/wishlist/types.ts
  - utils/wishlist.ts
autonomous: true

must_haves:
  truths:
    - "TypeScript types exist for all new wishlist components"
    - "Utility functions parse brands, format prices, and provide placeholders"
    - "Existing LuxuryWishlistCard continues to work unchanged"
    - "Types can be imported without circular dependencies"
  artifacts:
    - path: "components/wishlist/types.ts"
      provides: "Shared type definitions for wishlist components"
      exports: ["WishlistGridCardProps", "ItemDetailScreenProps", "ItemOptionsSheetProps", "SplitStatusInfo", "SplitContributorInfo", "ClaimContext"]
      min_lines: 60
    - path: "utils/wishlist.ts"
      provides: "Utility functions for wishlist display"
      exports: ["parseBrandFromTitle", "formatPrice", "formatItemPrice", "getImagePlaceholder"]
      min_lines: 80
  key_links:
    - from: "components/wishlist/types.ts"
      to: "types/database.types.ts"
      via: "import WishlistItem"
      pattern: "import.*WishlistItem.*from"
    - from: "components/wishlist/types.ts"
      to: "lib/claims.ts"
      via: "import ClaimWithUser"
      pattern: "import.*ClaimWithUser.*from"
    - from: "utils/wishlist.ts"
      to: "constants/theme.ts"
      via: "import colors"
      pattern: "import.*colors.*from"
---

<objective>
Create the shared TypeScript type definitions and utility functions that will be used by the new wishlist components in later phases.

Purpose: Establish reusable code that keeps the new components clean and testable, extracting business logic (brand parsing, price formatting) into pure functions.

Output: components/wishlist/types.ts with all prop interfaces, utils/wishlist.ts with brand/price/placeholder utilities.
</objective>

<execution_context>
@/home/zetaz/.claude/get-shit-done/workflows/execute-plan.md
@/home/zetaz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/33-foundation-feature-inventory/33-RESEARCH.md
@components/wishlist/LuxuryWishlistCard.tsx
@types/database.types.ts
@lib/claims.ts
@constants/theme.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Shared Wishlist Types</name>
  <files>components/wishlist/types.ts</files>
  <action>
Create a new file `components/wishlist/types.ts` with shared type definitions.

Extract and export:

1. **SplitStatusInfo** - Currently inline in LuxuryWishlistCard (lines 24-30)
2. **SplitContributorInfo** - Currently inline in LuxuryWishlistCard (lines 33-38)
3. **FavoriteGroupInfo** - For badge display
4. **ClaimContext** - Discriminated union for role-based rendering

Define new component props interfaces:

5. **WishlistGridCardProps** - Minimal props for grid display:
   - item: WishlistItem
   - isFavorite: boolean
   - onPress: () => void
   - index: number
   - isTaken?: boolean (celebrant view)
   - claim?: ClaimWithUser | null (non-celebrant view)
   - isYourClaim?: boolean

6. **ItemDetailScreenProps** - Full functionality for detail page:
   - item: WishlistItem
   - All claim props (claimable, onClaim, onUnclaim, claiming, claim, isYourClaim, isTaken, isCelebrant)
   - All split props (splitStatus, contributors, userPledgeAmount, suggestedShare, onOpenSplit, onPledge, onCloseSplit)
   - Favorite props (isFavorite, favoriteGroups, onToggleFavorite)
   - Navigation (onOpenOptions)

7. **ItemOptionsSheetProps** - Actions for item owner:
   - item: WishlistItem
   - isFavorite: boolean
   - priority: number
   - onToggleFavorite: () => void
   - onPriorityChange: (priority: number) => void
   - onShare: () => void
   - onEdit: () => void
   - onDelete: () => void
   - onClose: () => void

Import from existing files:
- WishlistItem from '@/types/database.types'
- ClaimWithUser from '@/lib/claims'

Use JSDoc comments explaining each interface's purpose and context.

Do NOT modify LuxuryWishlistCard.tsx - it will continue using its inline types until Phase 34+.
  </action>
  <verify>
Run: `npx tsc --noEmit components/wishlist/types.ts 2>&1`
Expected: No type errors

Run: `grep "export interface\|export type" components/wishlist/types.ts | wc -l`
Expected: At least 7 exports

Run: `grep "import.*WishlistItem" components/wishlist/types.ts`
Expected: Shows import from database.types
  </verify>
  <done>components/wishlist/types.ts exists with all 7 interfaces/types exported, no TypeScript errors, imports WishlistItem and ClaimWithUser correctly</done>
</task>

<task type="auto">
  <name>Task 2: Create Wishlist Utility Functions</name>
  <files>utils/wishlist.ts</files>
  <action>
Create a new file `utils/wishlist.ts` with pure utility functions.

Implement based on 33-RESEARCH.md code examples:

1. **parseBrandFromTitle(title: string | null | undefined): string | null**
   - Extract brand from product title using separator detection and first-word heuristics
   - Handle edge cases: null input, numbers, size patterns, stop words
   - Return null if no confident brand extraction

2. **formatPrice(price: number | null | undefined, currency?: '$' | 'â‚¬'): string | null**
   - Format price with currency symbol and 2 decimal places
   - Return null for null/undefined/zero prices
   - Default currency is '$'

3. **formatItemPrice(item: { price?: number | null; item_type?: string; mystery_box_tier?: 50 | 100 | null; surprise_me_budget?: number | null }): string | null**
   - Handle special item types (mystery_box shows tier, surprise_me shows budget)
   - Fall back to formatPrice for standard items

4. **getImagePlaceholder(itemType: 'standard' | 'surprise_me' | 'mystery_box' | undefined): PlaceholderConfig**
   - Return icon name, icon color, and background color based on item type
   - Match existing LuxuryWishlistCard icon logic (getCardIcon function)
   - Use colors from '@/constants/theme'

Define PlaceholderConfig interface locally:
```typescript
interface PlaceholderConfig {
  iconName: 'gift-outline' | 'help-circle' | 'gift';
  iconColor: string;
  backgroundColor: string;
}
```

Include JSDoc comments with @example tags showing expected inputs/outputs.

These functions are pure (no side effects) and can be unit tested.
  </action>
  <verify>
Run: `npx tsc --noEmit utils/wishlist.ts 2>&1`
Expected: No type errors

Run: `grep "export function" utils/wishlist.ts | wc -l`
Expected: At least 4 exports

Run: `grep "@example" utils/wishlist.ts | wc -l`
Expected: At least 4 examples documented

Test brand parsing logic manually:
```bash
node -e "
const code = require('fs').readFileSync('utils/wishlist.ts', 'utf8');
// Check for BRAND_STOP_WORDS constant
console.log(code.includes('BRAND_STOP_WORDS') ? 'PASS: Has stop words' : 'FAIL: Missing stop words');
// Check for SIZE_PATTERN
console.log(code.includes('SIZE_PATTERN') ? 'PASS: Has size pattern' : 'FAIL: Missing size pattern');
"
```
  </verify>
  <done>utils/wishlist.ts exists with 4 exported functions, all have @example JSDoc, no TypeScript errors, includes brand parsing constants (BRAND_STOP_WORDS, SIZE_PATTERN)</done>
</task>

<task type="auto">
  <name>Task 3: Verify No Regressions</name>
  <files>N/A (verification only)</files>
  <action>
Verify that the new files don't break existing code:

1. Run full TypeScript check on the project
2. Verify LuxuryWishlistCard.tsx still compiles
3. Verify no circular import issues

This is a verification task - no files are modified.
  </action>
  <verify>
Run full project type check:
```bash
npx tsc --noEmit 2>&1 | head -50
```
Expected: No NEW errors (pre-existing errors documented in STATE.md are acceptable)

Verify LuxuryWishlistCard still works:
```bash
npx tsc --noEmit components/wishlist/LuxuryWishlistCard.tsx 2>&1
```
Expected: Compiles without errors

Check for circular imports:
```bash
# The new types.ts should not import from components that will import it
grep -l "from.*types" components/wishlist/*.tsx 2>/dev/null | head -5 || echo "No circular risk detected"
```
  </verify>
  <done>Full project type check passes (no new errors), LuxuryWishlistCard.tsx compiles, no circular import issues detected</done>
</task>

</tasks>

<verification>
Phase 33 Plan 02 is complete when:
1. components/wishlist/types.ts exports all 7 interfaces/types
2. utils/wishlist.ts exports all 4 utility functions
3. Both files pass TypeScript compilation
4. No new errors introduced to the codebase
5. LuxuryWishlistCard.tsx continues to work unchanged
</verification>

<success_criteria>
- `npx tsc --noEmit` has no new errors compared to baseline
- types.ts exports: WishlistGridCardProps, ItemDetailScreenProps, ItemOptionsSheetProps, SplitStatusInfo, SplitContributorInfo, FavoriteGroupInfo, ClaimContext
- utils/wishlist.ts exports: parseBrandFromTitle, formatPrice, formatItemPrice, getImagePlaceholder
- All functions have JSDoc with @example tags
</success_criteria>

<output>
After completion, create `.planning/phases/33-foundation-feature-inventory/33-02-SUMMARY.md`
</output>
