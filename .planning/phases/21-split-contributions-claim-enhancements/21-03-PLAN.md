---
phase: 21-split-contributions-claim-enhancements
plan: 03
type: execute
wave: 2
depends_on: ["21-01"]
files_modified:
  - components/wishlist/SplitContributionProgress.tsx
  - components/wishlist/ContributorsDisplay.tsx
  - components/wishlist/SplitModal.tsx
  - components/celebrations/ClaimSummary.tsx
autonomous: true

must_haves:
  truths:
    - "SplitContributionProgress shows progress bar with $X of $Y format"
    - "ContributorsDisplay shows avatar row with amounts below each avatar"
    - "SplitModal allows entering pledge amount with validation"
    - "ClaimSummary shows '3 of 8 items claimed' format"
    - "Celebrant view shows only boolean status (no amounts/names)"
  artifacts:
    - path: "components/wishlist/SplitContributionProgress.tsx"
      provides: "Progress bar for split funding"
      min_lines: 50
    - path: "components/wishlist/ContributorsDisplay.tsx"
      provides: "Avatar row with contribution amounts"
      min_lines: 40
    - path: "components/wishlist/SplitModal.tsx"
      provides: "Modal for pledging contribution amount"
      min_lines: 80
    - path: "components/celebrations/ClaimSummary.tsx"
      provides: "Claim count summary display"
      min_lines: 30
  key_links:
    - from: "SplitContributionProgress"
      to: "Contributor[]"
      via: "props"
      pattern: "contributors.*Contributor"
    - from: "SplitModal"
      to: "pledgeContribution"
      via: "onConfirm callback"
      pattern: "onConfirm.*amount"
---

<objective>
Create UI components for split contribution visualization and interaction: progress bar, contributor avatars, pledge modal, and claim count summary.

Purpose: Provide the visual elements needed for split contribution UX - progress tracking, contributor visibility, and pledge input.
Output: 4 new React Native components in components/wishlist/ and components/celebrations/.
</objective>

<execution_context>
@/home/zetaz/.claude/get-shit-done/workflows/execute-plan.md
@/home/zetaz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/21-split-contributions-claim-enhancements/21-CONTEXT.md
@.planning/phases/21-split-contributions-claim-enhancements/21-RESEARCH.md
@components/celebrations/ContributionProgress.tsx
@components/groups/BudgetProgressBar.tsx
@components/wishlist/ClaimerAvatar.tsx
@constants/theme.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SplitContributionProgress and ContributorsDisplay components</name>
  <files>components/wishlist/SplitContributionProgress.tsx, components/wishlist/ContributorsDisplay.tsx</files>
  <action>
**1. SplitContributionProgress.tsx**

Adapt from ContributionProgress.tsx with these changes:

```typescript
interface SplitContributionProgressProps {
  itemPrice: number;
  additionalCosts?: number | null;
  totalPledged: number;
  isFullyFunded: boolean;
  isCelebrant?: boolean;  // Show boolean-only view
}
```

- Progress bar using BudgetProgressBar pattern (horizontal, themed colors)
- Display format: "$X of $Y funded" where Y = itemPrice + additionalCosts
- If additionalCosts exists, show breakdown: "Item: $X + Shipping: $Y"
- Fully funded state: green progress fill + check badge
- Celebrant view: only show "Taken" or "In Progress" text, no amounts

Use colors from constants/theme.ts:
- Progress fill: colors.burgundy[600] normally, colors.success when complete
- Background: colors.cream[200]

**2. ContributorsDisplay.tsx**

```typescript
interface ContributorsDisplayProps {
  contributors: Array<{
    id: string;
    display_name: string | null;
    avatar_url: string | null;
    amount: number;
  }>;
  maxVisible?: number;  // Default 5, show "+N more" for overflow
}
```

- Horizontal row of avatars using ClaimerAvatar pattern (32px size)
- Below each avatar: "$X" amount text
- Tap avatar to show name modal (reuse ClaimerAvatar's modal pattern)
- If more than maxVisible, show "+N" indicator
- Empty state: don't render anything

Styles follow existing patterns:
- flexDirection: 'row', gap: spacing.sm
- Amount text: fontSize 12, colors.cream[600]
  </action>
  <verify>
Run `npx tsc --noEmit` to verify TypeScript compiles.
Check both components export default properly.
  </verify>
  <done>
SplitContributionProgress shows funding progress with celebrant-safe view. ContributorsDisplay shows avatar row with amounts.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create SplitModal and ClaimSummary components</name>
  <files>components/wishlist/SplitModal.tsx, components/celebrations/ClaimSummary.tsx</files>
  <action>
**1. SplitModal.tsx**

Modal for entering pledge amount:

```typescript
interface SplitModalProps {
  visible: boolean;
  onClose: () => void;
  onConfirm: (amount: number) => void;
  itemTitle: string;
  itemPrice: number;
  additionalCosts?: number | null;
  totalPledged: number;
  suggestedAmount?: number;  // Equal share calculation
  loading?: boolean;
}
```

Implementation:
- Modal container with KeyboardAvoidingView (from ContributionModal.tsx pattern)
- Header: "Contribute to [Item Title]"
- Show progress info: "$X of $Y funded, $Z remaining"
- Amount input: TextInput with keyboardType="decimal-pad"
- Validation: amount > 0, amount <= remaining
- Suggested amount button: "Split equally: $X" (fills input)
- Confirm button: "Pledge $X" (disabled if invalid)
- Cancel button: "Cancel"
- Loading state: ActivityIndicator on confirm button

Validation error display:
- "Amount exceeds remaining ($X)"
- "Enter a positive amount"

**2. ClaimSummary.tsx**

```typescript
interface ClaimSummaryProps {
  totalItems: number;
  claimedItems: number;  // Full claims only
  splitItems: number;    // Items with split contributions
}
```

Display format: "3 of 8 items claimed"
- Icon: MaterialCommunityIcons "gift" for full, "gift-open" for split
- Optional detail: "(2 full, 1 split)" if splitItems > 0
- Compact inline style for header placement

Styles:
- flexDirection: 'row', alignItems: 'center', gap: spacing.xs
- Text: fontSize 14, colors.cream[700]
- Fits in celebration header row
  </action>
  <verify>
Run `npx tsc --noEmit` to verify TypeScript compiles.
Verify SplitModal handles keyboard properly and validates input.
Verify ClaimSummary renders correct format.
  </verify>
  <done>
SplitModal provides pledge input with validation. ClaimSummary displays claim count in header format.
  </done>
</task>

</tasks>

<verification>
- [ ] All 4 components created and export correctly
- [ ] SplitContributionProgress handles celebrant view (no amounts)
- [ ] ContributorsDisplay handles overflow with "+N" indicator
- [ ] SplitModal validates amount against remaining
- [ ] ClaimSummary shows correct format with icons
- [ ] All components use theme constants
- [ ] TypeScript compiles without errors
</verification>

<success_criteria>
- Components render correctly in isolation
- Props interfaces are well-typed
- Celebrant privacy maintained in progress component
- Modal handles keyboard and validation
- Summary component is compact for header placement
</success_criteria>

<output>
After completion, create `.planning/phases/21-split-contributions-claim-enhancements/21-03-SUMMARY.md`
</output>
