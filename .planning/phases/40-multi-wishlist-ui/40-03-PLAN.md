---
phase: 40-multi-wishlist-ui
plan: 03
type: execute
wave: 2
depends_on: ["40-01", "40-02"]
files_modified:
  - components/wishlist/CreateWishlistModal.tsx
  - components/wishlist/EmojiPickerModal.tsx
  - components/wishlist/WishlistManager.tsx
  - locales/en/translation.json
  - locales/es/translation.json
autonomous: false

must_haves:
  truths:
    - "User can create new wishlist with name and emoji (WISH-01)"
    - "User can rename an existing wishlist (WISH-02)"
    - "User can delete a non-default wishlist with confirmation (WISH-03)"
    - "Emoji picker shows categorized emoji grid"
  artifacts:
    - path: "components/wishlist/CreateWishlistModal.tsx"
      provides: "Create and edit wishlist modal"
      min_lines: 150
    - path: "components/wishlist/EmojiPickerModal.tsx"
      provides: "Simple emoji category grid picker"
      min_lines: 80
  key_links:
    - from: "components/wishlist/CreateWishlistModal.tsx"
      to: "hooks/useWishlists.ts"
      via: "import"
      pattern: "useCreateWishlist|useUpdateWishlist"
    - from: "components/wishlist/WishlistManager.tsx"
      to: "components/wishlist/CreateWishlistModal.tsx"
      via: "import"
      pattern: "CreateWishlistModal"
---

<objective>
Create CRUD modals for wishlist management: create, edit, and delete with emoji picker.

Purpose: Enable full wishlist lifecycle management (WISH-01, WISH-02, WISH-03).
Output: CreateWishlistModal (create + edit), EmojiPickerModal, delete confirmation, translations
</objective>

<execution_context>
@/home/zetaz/.claude/get-shit-done/workflows/execute-plan.md
@/home/zetaz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/40-multi-wishlist-ui/40-02-PLAN.md

# Modal patterns to follow
@components/groups/CreateGroupModal.tsx
@components/wishlist/GroupPickerSheet.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create EmojiPickerModal component</name>
  <files>components/wishlist/EmojiPickerModal.tsx</files>
  <action>
Create `components/wishlist/EmojiPickerModal.tsx`:

1. Props interface:
   ```typescript
   interface EmojiPickerModalProps {
     visible: boolean;
     onClose: () => void;
     onSelect: (emoji: string) => void;
     selectedEmoji?: string;
   }
   ```

2. Emoji categories (from research):
   ```typescript
   const EMOJI_CATEGORIES = {
     common: ['ğŸ', 'ğŸ’', 'ğŸ„', 'ğŸ‚', 'ğŸ’', 'ğŸ‘—', 'ğŸ‘Ÿ', 'ğŸ“±', 'ğŸ®', 'ğŸ“š'],
     objects: ['âŒš', 'ğŸ‘œ', 'ğŸ’„', 'ğŸ’', 'ğŸ‘“', 'ğŸ§', 'ğŸ’»', 'ğŸ–¥ï¸', 'ğŸ¸', 'ğŸ¹'],
     food: ['ğŸ°', 'ğŸ«', 'â˜•', 'ğŸ·', 'ğŸ¾', 'ğŸ§', 'ğŸª', 'ğŸ¥‚', 'ğŸº', 'ğŸ¥¤'],
     activities: ['âš½', 'ğŸ€', 'ğŸ¿', 'ğŸŠ', 'ğŸš´', 'ğŸ§˜', 'ğŸ¨', 'ğŸ­', 'ğŸ¬', 'ğŸ¤'],
     travel: ['âœˆï¸', 'ğŸš—', 'ğŸ ', 'ğŸ–ï¸', 'ğŸ”ï¸', 'ğŸŒ´', 'ğŸ—½', 'ğŸ—¼', 'ğŸ¢', 'â›º'],
     symbols: ['â¤ï¸', 'â­', 'âœ¨', 'ğŸ”¥', 'ğŸ’', 'ğŸ†', 'ğŸ¯', 'ğŸ’«', 'ğŸŒŸ', 'ğŸ’°'],
   };
   ```

3. Component structure:
   - Modal with transparent background (fade animation)
   - Card container with rounded corners
   - Title: "Choose Emoji" (t('wishlists.chooseEmoji'))
   - Category tabs or headers with emoji grid below each
   - Each emoji: TouchableOpacity, 40x40, selected state with border
   - Close button at bottom

4. Styling:
   - Follow CreateGroupModal patterns (rounded modal, white background)
   - Grid: 5 emojis per row using flexWrap
   - Category headers: 14px, fontWeight 600, colors.burgundy[600]
   - Selected emoji: border 2px colors.burgundy[400]
  </action>
  <verify>
   - Component exports default function
   - All 6 emoji categories defined
   - No TypeScript errors: `npx tsc --noEmit components/wishlist/EmojiPickerModal.tsx`
  </verify>
  <done>
   EmojiPickerModal created with categorized emoji grid, selection highlighting, and close handling.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create CreateWishlistModal for create and edit</name>
  <files>components/wishlist/CreateWishlistModal.tsx</files>
  <action>
Create `components/wishlist/CreateWishlistModal.tsx` that handles both create and edit:

1. Props interface:
   ```typescript
   interface CreateWishlistModalProps {
     visible: boolean;
     onClose: () => void;
     onSuccess: () => void;
     editingWishlist?: Wishlist | null; // If provided, edit mode
   }
   ```

2. State:
   - name: string (50 char max)
   - emoji: string (default 'ğŸ')
   - loading: boolean
   - showEmojiPicker: boolean

3. Mode detection:
   - isEditMode = !!editingWishlist
   - Pre-populate name/emoji in edit mode via useEffect

4. Validation:
   - Name required, trim whitespace
   - Max 50 characters (like group name)

5. Submit handler:
   - Create mode: useCreateWishlist mutation
   - Edit mode: useUpdateWishlist mutation
   - On success: Alert success message, onSuccess(), onClose()
   - On error: Alert error message

6. Layout (follow CreateGroupModal):
   - Modal with slide animation
   - KeyboardAvoidingView wrapper
   - Header: "Create Wishlist" or "Edit Wishlist" based on mode
   - Close X button in header
   - Emoji display with "Change" button (opens EmojiPickerModal)
   - Name TextInput
   - Create/Save button (disabled while loading)

7. Note about delete: Delete is handled separately via Alert.alert confirmation in WishlistManager, not in this modal.
  </action>
  <verify>
   - Component handles both create and edit modes
   - Uses useCreateWishlist and useUpdateWishlist hooks
   - EmojiPickerModal integrated
   - No TypeScript errors: `npx tsc --noEmit components/wishlist/CreateWishlistModal.tsx`
  </verify>
  <done>
   CreateWishlistModal created supporting create (WISH-01) and edit (WISH-02) modes with emoji picker integration.
  </done>
</task>

<task type="auto">
  <name>Task 3: Wire modals into WishlistManager and add translations</name>
  <files>components/wishlist/WishlistManager.tsx, locales/en/translation.json, locales/es/translation.json</files>
  <action>
1. Update WishlistManager.tsx to wire in modals:

   Add state:
   ```typescript
   const [showCreateModal, setShowCreateModal] = useState(false);
   const [editingWishlist, setEditingWishlist] = useState<Wishlist | null>(null);
   ```

   Add delete handler with confirmation:
   ```typescript
   const handleDeleteWishlist = (wishlist: Wishlist) => {
     if (wishlist.is_default) {
       Alert.alert(
         t('wishlists.cannotDeleteDefault'),
         t('wishlists.cannotDeleteDefaultMessage')
       );
       return;
     }
     Alert.alert(
       t('wishlists.deleteWishlist'),
       t('wishlists.deleteConfirmation', { name: wishlist.name }),
       [
         { text: t('common.cancel'), style: 'cancel' },
         {
           text: t('common.delete'),
           style: 'destructive',
           onPress: () => deleteMutation.mutate(wishlist.id)
         }
       ]
     );
   };
   ```

   Add modals to render:
   ```jsx
   <CreateWishlistModal
     visible={showCreateModal || !!editingWishlist}
     onClose={() => { setShowCreateModal(false); setEditingWishlist(null); }}
     onSuccess={() => refetch()}
     editingWishlist={editingWishlist}
   />
   ```

   Wire header add button:
   ```jsx
   <TouchableOpacity onPress={() => setShowCreateModal(true)}>
     <MaterialCommunityIcons name="plus" size={24} color={colors.burgundy[600]} />
   </TouchableOpacity>
   ```

2. Add translations to locales/en/translation.json under "wishlists" key:
   ```json
   "wishlists": {
     "myWishlists": "My Wishlists",
     "manageWishlists": "Manage Wishlists",
     "createWishlist": "Create Wishlist",
     "editWishlist": "Edit Wishlist",
     "wishlistName": "Wishlist Name",
     "namePlaceholder": "e.g., Birthday 2026",
     "chooseEmoji": "Choose Emoji",
     "changeEmoji": "Change",
     "default": "Default",
     "deleteWishlist": "Delete Wishlist",
     "deleteConfirmation": "Are you sure you want to delete \"{{name}}\"? Items will remain but won't be in any wishlist.",
     "cannotDeleteDefault": "Cannot Delete",
     "cannotDeleteDefaultMessage": "The default wishlist cannot be deleted.",
     "wishlistCreated": "Wishlist created!",
     "wishlistUpdated": "Wishlist updated!",
     "wishlistDeleted": "Wishlist deleted",
     "allItems": "All Items",
     "showAllItems": "Show All",
     "items": "{{count}} items"
   }
   ```

3. Add Spanish translations to locales/es/translation.json:
   ```json
   "wishlists": {
     "myWishlists": "Mis Listas",
     "manageWishlists": "Gestionar Listas",
     "createWishlist": "Crear Lista",
     "editWishlist": "Editar Lista",
     "wishlistName": "Nombre de la Lista",
     "namePlaceholder": "ej., Cumpleanos 2026",
     "chooseEmoji": "Elegir Emoji",
     "changeEmoji": "Cambiar",
     "default": "Predeterminada",
     "deleteWishlist": "Eliminar Lista",
     "deleteConfirmation": "Estas seguro de que quieres eliminar \"{{name}}\"? Los articulos permaneceran pero no estaran en ninguna lista.",
     "cannotDeleteDefault": "No se puede eliminar",
     "cannotDeleteDefaultMessage": "La lista predeterminada no se puede eliminar.",
     "wishlistCreated": "Lista creada!",
     "wishlistUpdated": "Lista actualizada!",
     "wishlistDeleted": "Lista eliminada",
     "allItems": "Todos los Articulos",
     "showAllItems": "Mostrar Todos",
     "items": "{{count}} articulos"
   }
   ```
  </action>
  <verify>
   - Create modal opens from WishlistManager
   - Edit modal opens with wishlist data pre-populated
   - Delete shows confirmation alert (not for default wishlist)
   - Translations exist in both en and es locale files
  </verify>
  <done>
   WishlistManager fully wired with create, edit, and delete flows. Translations added for English and Spanish.
  </done>
</task>

</tasks>

<verification>
1. EmojiPickerModal shows emoji categories and allows selection
2. CreateWishlistModal creates new wishlist (WISH-01)
3. CreateWishlistModal edits existing wishlist (WISH-02)
4. Delete confirmation shows for non-default wishlists (WISH-03)
5. Default wishlist cannot be deleted (alert explains why)
6. Translations present in en/es locale files
</verification>

<success_criteria>
- User can create new wishlist with name and emoji (WISH-01)
- User can rename and change emoji of existing wishlist (WISH-02)
- User can delete non-default wishlist with confirmation (WISH-03)
- Default wishlist shows delete-protection messaging
- All UI text is internationalized
</success_criteria>

<output>
After completion, create `.planning/phases/40-multi-wishlist-ui/40-03-SUMMARY.md`
</output>
