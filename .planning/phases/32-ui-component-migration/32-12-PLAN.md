---
phase: 32-ui-component-migration
plan: 12
type: execute
wave: 4
depends_on: ["32-02", "32-03", "32-04", "32-05", "32-06", "32-07", "32-08", "32-09", "32-10", "32-11"]
files_modified:
  - utils/countdown.ts
  - utils/deviceCalendar.ts
autonomous: true

must_haves:
  truths:
    - "getCountdownText returns translated strings when t function provided"
    - "Device calendar event text can be localized"
    - "Countdown utility maintains backward compatibility"
  artifacts:
    - path: "utils/countdown.ts"
      provides: "Localized countdown text utility"
      exports: ["getCountdownText", "getLocalizedCountdownText"]
  key_links:
    - from: "utils/countdown.ts"
      to: "src/i18n/locales/en.json"
      via: "t() function parameter"
      pattern: "calendar\\.countdown\\."
---

<objective>
Update utility functions to support localization

Purpose: Utilities like countdown.ts return user-facing text that needs translation
Output: Utilities support localized output while maintaining backward compatibility
</objective>

<execution_context>
@/home/zetaz/.claude/get-shit-done/workflows/execute-plan.md
@/home/zetaz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/32-ui-component-migration/32-RESEARCH.md
@src/i18n/locales/en.json
@utils/countdown.ts
@utils/deviceCalendar.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update countdown.ts for localization</name>
  <files>utils/countdown.ts</files>
  <action>
Modify getCountdownText to accept an optional t function for localization:

1. Add a new type for the translation function:
   ```typescript
   type TranslationFn = (key: string, options?: { count?: number }) => string;
   ```

2. Update getCountdownText signature to accept optional t parameter:
   ```typescript
   /**
    * Get a human-readable countdown string
    * @param daysUntil - Number of days until birthday
    * @param t - Optional translation function from useTranslation()
    * @returns Formatted string like "TODAY!", "Tomorrow", "5 days"
    */
   export function getCountdownText(
     daysUntil: number,
     t?: TranslationFn
   ): string {
     // If no translation function, return English (backward compatible)
     if (!t) {
       if (daysUntil === 0) return 'TODAY!';
       if (daysUntil === 1) return 'Tomorrow';
       if (daysUntil === -1) return 'Invalid date';
       return `${daysUntil} days`;
     }

     // Use translation function for localized output
     if (daysUntil === 0) return t('calendar.countdown.today');
     if (daysUntil === 1) return t('calendar.countdown.tomorrow');
     if (daysUntil === -1) return t('common.errors.generic');

     if (daysUntil <= 7) {
       return t('calendar.countdown.daysLeft', { count: daysUntil });
     } else if (daysUntil <= 30) {
       const weeks = Math.floor(daysUntil / 7);
       return t('calendar.countdown.weeksLeft', { count: weeks });
     } else {
       const months = Math.floor(daysUntil / 30);
       return t('calendar.countdown.monthsLeft', { count: months });
     }
   }
   ```

3. This approach:
   - Maintains backward compatibility (existing calls without t still work)
   - Enables localization when t is provided
   - Uses i18next pluralization for "days/weeks/months left"

4. Existing callers can gradually be updated to pass t:
   ```typescript
   // Old way (still works, returns English)
   getCountdownText(days)

   // New way (returns localized text)
   const { t } = useTranslation();
   getCountdownText(days, t)
   ```
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - `grep "t\\?: TranslationFn" utils/countdown.ts` shows optional t parameter
    - Existing calls without t parameter still compile
  </verify>
  <done>
    - getCountdownText accepts optional t function
    - Without t, returns English (backward compatible)
    - With t, returns localized text using i18next
    - TypeScript types are correct
  </done>
</task>

<task type="auto">
  <name>Task 2: Update deviceCalendar.ts for localization</name>
  <files>utils/deviceCalendar.ts</files>
  <action>
Review deviceCalendar.ts and update for localization where applicable:

1. Identify user-facing strings in the file:
   - Calendar event titles (e.g., "{name}'s Birthday")
   - Event descriptions
   - Any alert messages

2. For calendar event titles, add optional t function parameter similar to countdown.ts:
   ```typescript
   type TranslationFn = (key: string, options?: Record<string, string>) => string;

   export function createBirthdayEventTitle(
     name: string,
     t?: TranslationFn
   ): string {
     if (!t) {
       return `${name}'s Birthday`;
     }
     return t('calendar.eventTitle.birthday', { name });
   }
   ```

3. Note: Device calendar may display text based on device system language, not app language. The translation is for the event as created by the app, but the device calendar app may override display. Document this limitation.

4. For any Alert.alert() calls in this file:
   - If they reference t function from caller, ensure translated
   - If standalone utility, document that caller should handle alerts

5. Add JSDoc comment noting the localization approach:
   ```typescript
   /**
    * Note: Calendar event text is created in app language, but device calendar
    * display may vary based on system settings.
    */
   ```
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - Device calendar utility supports localization where applicable
  </verify>
  <done>
    - deviceCalendar.ts supports localized event titles
    - Backward compatible with existing callers
    - Documented that device display may vary
  </done>
</task>

</tasks>

<verification>
1. TypeScript compiles: `npx tsc --noEmit`
2. countdown.ts has optional t parameter
3. Existing callers still compile without changes
4. Components that pass t receive localized countdown text
</verification>

<success_criteria>
- getCountdownText works without t (backward compatible)
- getCountdownText with t returns localized text
- deviceCalendar supports localized event titles
- No breaking changes to existing code
</success_criteria>

<output>
After completion, create `.planning/phases/32-ui-component-migration/32-12-SUMMARY.md`
</output>
