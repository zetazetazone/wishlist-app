---
phase: 41-column-rename
plan: 02
type: execute
wave: 2
depends_on: ["41-01"]
files_modified:
  - app/(app)/shared-url.tsx
  - app/(app)/add-from-url.tsx
  - app/(app)/(tabs)/index.tsx
  - components/wishlist/OptionsSheet.tsx
  - lib/shareIntent.ts
  - components/wishlist/AddItemModal.tsx
  - app/(app)/wishlist/[id].tsx
  - components/wishlist/LuxuryWishlistCard.tsx
  - components/wishlist/WishlistItemCardSimple.tsx
  - components/wishlist/WishlistItemCard.tsx
  - components/wishlist/LuxuryBottomSheet.tsx
  - components/wishlist/AddItemBottomSheet.tsx
autonomous: true

must_haves:
  truths:
    - "All TypeScript files compile without errors"
    - "No references to amazon_url remain in source code"
    - "App functionality unchanged (just renamed property)"
  artifacts:
    - path: "app/(app)/shared-url.tsx"
      provides: "Share URL screen"
      contains: "source_url"
    - path: "components/wishlist/AddItemModal.tsx"
      provides: "Add item modal"
      contains: "source_url"
    - path: "lib/shareIntent.ts"
      provides: "Share intent utilities"
      contains: "source_url"
  key_links:
    - from: "components/wishlist/*.tsx"
      to: "types/database.types.ts"
      via: "WishlistItem type import"
      pattern: "source_url"
---

<objective>
Update all source files to use source_url instead of amazon_url.

Purpose: Complete the rename by updating all TypeScript/TSX files to reference the new column name, ensuring type safety and eliminating all legacy references.

Output: All source files updated, TypeScript compiles cleanly
</objective>

<execution_context>
@/home/zetaz/.claude/get-shit-done/workflows/execute-plan.md
@/home/zetaz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Updated types from Plan 01
@types/database.types.ts

# Files to update (from grep analysis)
@app/(app)/shared-url.tsx
@app/(app)/add-from-url.tsx
@components/wishlist/AddItemModal.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update core source files</name>
  <files>
app/(app)/shared-url.tsx
app/(app)/add-from-url.tsx
app/(app)/(tabs)/index.tsx
components/wishlist/OptionsSheet.tsx
lib/shareIntent.ts
components/wishlist/AddItemModal.tsx
app/(app)/wishlist/[id].tsx
  </files>
  <action>
For each file, perform a direct find-and-replace of `amazon_url` with `source_url`.

This is a mechanical rename - the property name changes but the semantics are identical.

Files to update (7 core files):
1. `app/(app)/shared-url.tsx` - Share intent handler screen
2. `app/(app)/add-from-url.tsx` - Add from URL screen
3. `app/(app)/(tabs)/index.tsx` - Main wishlist tab
4. `components/wishlist/OptionsSheet.tsx` - Item options sheet
5. `lib/shareIntent.ts` - Share intent utilities
6. `components/wishlist/AddItemModal.tsx` - Add item modal
7. `app/(app)/wishlist/[id].tsx` - Wishlist detail screen

For each file:
- Replace all occurrences of `amazon_url` with `source_url`
- This includes property access (item.amazon_url), object literals ({amazon_url: ...}), and destructuring

Verify each file compiles after editing by checking for TypeScript errors.
  </action>
  <verify>
Run: `grep -r "amazon_url" app/(app)/ lib/ --include="*.ts" --include="*.tsx"` (should return nothing)
Run: `npx tsc --noEmit` on these files (no errors expected after all updates)
  </verify>
  <done>All 7 core source files use source_url, no amazon_url references remain</done>
</task>

<task type="auto">
  <name>Task 2: Update component files</name>
  <files>
components/wishlist/LuxuryWishlistCard.tsx
components/wishlist/WishlistItemCardSimple.tsx
components/wishlist/WishlistItemCard.tsx
components/wishlist/LuxuryBottomSheet.tsx
components/wishlist/AddItemBottomSheet.tsx
  </files>
  <action>
Update the remaining 5 component files with the same find-and-replace:

1. `components/wishlist/LuxuryWishlistCard.tsx` - Luxury card component
2. `components/wishlist/WishlistItemCardSimple.tsx` - Simple card variant
3. `components/wishlist/WishlistItemCard.tsx` - Standard card component
4. `components/wishlist/LuxuryBottomSheet.tsx` - Luxury bottom sheet
5. `components/wishlist/AddItemBottomSheet.tsx` - Add item bottom sheet

For each file:
- Replace all occurrences of `amazon_url` with `source_url`
- Preserve all other code unchanged

These components display item URLs and pass them to modals/sheets - the rename is purely cosmetic at the code level.
  </action>
  <verify>
Run: `grep -r "amazon_url" components/wishlist/ --include="*.tsx"` (should return nothing)
  </verify>
  <done>All 5 component files use source_url, no amazon_url references remain</done>
</task>

<task type="auto">
  <name>Task 3: Clean up backup/test files and verify</name>
  <files>
app/(app)/(tabs)/wishlist-old-backup.tsx
app/(app)/(tabs)/wishlist-simple.tsx
app/(app)/(tabs)/wishlist-luxury.tsx
scripts/seed-test-data-simple.sql
scripts/seed-test-data.sql
  </files>
  <action>
Update remaining files for consistency:

1. **Backup files** (3 files) - These are old UI variants kept for reference:
   - `app/(app)/(tabs)/wishlist-old-backup.tsx`
   - `app/(app)/(tabs)/wishlist-simple.tsx`
   - `app/(app)/(tabs)/wishlist-luxury.tsx`

   Replace `amazon_url` with `source_url` for consistency (even though unused).

2. **Seed scripts** (2 files) - Test data scripts:
   - `scripts/seed-test-data-simple.sql`
   - `scripts/seed-test-data.sql`

   Replace `amazon_url` with `source_url` in INSERT statements.

3. **Final verification** - Run full codebase check:
   ```bash
   grep -r "amazon_url" --include="*.ts" --include="*.tsx" --include="*.sql" .
   ```
   Should return ONLY matches in:
   - `supabase/migrations/20260201000001_initial_schema.sql` (original schema - DO NOT modify)
   - `supabase/migrations/20260203000001_fix_special_items.sql` (historical - DO NOT modify)
   - `.planning/` directory (documentation references are fine)

Historical migration files should NOT be modified - they represent the database state at that point in time.
  </action>
  <verify>
Run: `grep -r "amazon_url" --include="*.ts" --include="*.tsx" . | grep -v ".planning/" | grep -v "node_modules/"` (should return nothing)
Run: `npx tsc --noEmit` (full typecheck passes)
  </verify>
  <done>All active source files and seed scripts updated, TypeScript compiles cleanly, only historical migrations retain amazon_url</done>
</task>

</tasks>

<verification>
1. `grep -r "amazon_url" --include="*.ts" --include="*.tsx" .` returns no matches (excluding .planning/)
2. `npx tsc --noEmit` passes with zero errors
3. Seed scripts use source_url
4. Historical migration files (20260201, 20260203) unchanged
</verification>

<success_criteria>
- [ ] All 12 TypeScript/TSX source files use source_url
- [ ] All 2 seed SQL scripts use source_url
- [ ] `npx tsc --noEmit` passes
- [ ] `grep -r "amazon_url"` finds only historical migrations and planning docs
- [ ] No functional changes to app behavior
</success_criteria>

<output>
After completion, create `.planning/phases/41-column-rename/41-02-SUMMARY.md`
</output>
