---
phase: 36-options-sheet-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - components/wishlist/OptionsSheet.tsx
  - components/wishlist/index.ts
autonomous: true

must_haves:
  truths:
    - "Options sheet displays item preview with image/placeholder, title, price"
    - "Options sheet provides interactive star rating for priority adjustment"
    - "Options sheet provides favorite toggle, share, edit, delete buttons"
    - "Delete action shows confirmation dialog before proceeding"
  artifacts:
    - path: "components/wishlist/OptionsSheet.tsx"
      provides: "Options bottom sheet component with forwardRef pattern"
      exports: ["OptionsSheet", "OptionsSheetRef"]
      min_lines: 180
    - path: "components/wishlist/index.ts"
      provides: "Barrel export for OptionsSheet"
      contains: "OptionsSheet"
  key_links:
    - from: "components/wishlist/OptionsSheet.tsx"
      to: "@gorhom/bottom-sheet"
      via: "BottomSheet component"
      pattern: "import.*BottomSheet.*from.*@gorhom/bottom-sheet"
    - from: "components/wishlist/OptionsSheet.tsx"
      to: "components/ui/StarRating.tsx"
      via: "StarRating for priority"
      pattern: "import StarRating"
---

<objective>
Create the OptionsSheet component that displays item preview and action buttons.

Purpose: Enable owners to manage wishlist items (favorite, priority, share, edit, delete) from a consistent bottom sheet UI.
Output: `OptionsSheet.tsx` component with forwardRef pattern exposing `open(item)` and `close()` methods.
</objective>

<execution_context>
@/home/zetaz/.claude/get-shit-done/workflows/execute-plan.md
@/home/zetaz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/36-options-sheet-polish/36-RESEARCH.md
@components/wishlist/LuxuryBottomSheet.tsx
@components/ui/StarRating.tsx
@utils/wishlist.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create OptionsSheet component</name>
  <files>components/wishlist/OptionsSheet.tsx</files>
  <action>
Create `OptionsSheet.tsx` following the established pattern from LuxuryBottomSheet.tsx:

1. **Imports**:
   - `forwardRef, useImperativeHandle, useRef, useCallback, useState` from react
   - `View, Text, StyleSheet, Pressable, Alert, Share` from react-native
   - `Image` from expo-image
   - `useTranslation` from react-i18next
   - `useRouter` from expo-router
   - `BottomSheet, BottomSheetBackdrop` from @gorhom/bottom-sheet
   - `MaterialCommunityIcons` from @expo/vector-icons
   - `colors, spacing, borderRadius, shadows` from @/constants/theme
   - `formatItemPrice, getImagePlaceholder` from @/utils/wishlist
   - `StarRating` from @/components/ui/StarRating
   - `WishlistItem` type from @/types/database.types

2. **Interface definitions**:
   ```typescript
   interface OptionsSheetProps {
     onFavoriteToggle: (item: WishlistItem) => void;
     onPriorityChange: (itemId: string, priority: number) => void;
     onDelete: (itemId: string) => Promise<void>;
     isFavorite: (itemId: string) => boolean;
   }

   export interface OptionsSheetRef {
     open: (item: WishlistItem) => void;
     close: () => void;
   }
   ```

3. **Component structure** using forwardRef:
   - State: `item: WishlistItem | null` for current item
   - useImperativeHandle: `open(item)` sets state then expands, `close()` closes sheet
   - snapPoints: `['55%']` (fits preview + priority + 4 action buttons)
   - renderBackdrop with `pressBehavior="close"`, opacity 0.7

4. **Item preview section**:
   - 64x64 image (expo-image with cachePolicy, blurhash) OR placeholder icon based on item_type
   - Title (2-line max, numberOfLines={2})
   - Price (formatted via formatItemPrice)

5. **Priority section**:
   - Label: `t('wishlist.itemPriority')`
   - StarRating component with `onRatingChange` that calls `onPriorityChange` AND updates local item state

6. **Action buttons** (Pressable with pressed state styling):
   - **Favorite**: Heart icon (filled if favorite), label toggles between `t('wishlist.favorite.markFavorite')` / `t('wishlist.favorite.removeFavorite')`. Calls `onFavoriteToggle(item)`.
   - **Share**: share-variant icon, `t('common.share')` label. Uses React Native `Share.share({ message, title })`. Message = title + amazon_url (if exists).
   - **Edit**: pencil icon, `t('common.edit')` label. Shows Alert.alert with hardcoded "Edit feature coming soon" message (edit form doesn't exist yet - out of scope for v1.6). NOTE: Do NOT navigate to non-existent route - show alert instead. Use hardcoded English string for alert body (not a translation key) since this is temporary.
   - **Delete**: delete icon (error color), `t('common.delete')` label (error color). Shows Alert.alert confirmation with cancel/delete options. On confirm: calls `onDelete(item.id)` then closes sheet.

7. **Styling**: Match existing sheet styles:
   - Background: `colors.cream[50]`
   - Handle indicator: `colors.burgundy[300]`, width 48
   - Dividers between sections: 1px `colors.cream[200]`
   - Option buttons: flexDirection row, gap spacing.md, padding spacing.md
   - Pressed state: backgroundColor `colors.cream[100]`
   - Destructive text: `colors.error`

**CRITICAL**: Return null if `item` is null (early return before BottomSheet render).
**CRITICAL**: Edit button shows alert "Feature coming soon" - do NOT try to navigate to non-existent edit route.
  </action>
  <verify>
TypeScript compiles: `npx tsc --noEmit 2>&1 | grep -E "(OptionsSheet|error)" | head -20`
File exists with exports: `grep -E "export (const|interface) Options" components/wishlist/OptionsSheet.tsx`
  </verify>
  <done>
OptionsSheet.tsx exists with:
- OptionsSheetRef interface exported
- OptionsSheet component exported via forwardRef
- Preview section with image/placeholder, title, price
- StarRating for priority
- 4 action buttons: favorite, share, edit (alert), delete (confirmation)
  </done>
</task>

<task type="auto">
  <name>Task 2: Add OptionsSheet to barrel export</name>
  <files>components/wishlist/index.ts</files>
  <action>
Add OptionsSheet export to the barrel file:

```typescript
export { OptionsSheet, type OptionsSheetRef } from './OptionsSheet';
```

Ensure both the component and the ref type are exported for consumers.
  </action>
  <verify>
`grep "OptionsSheet" components/wishlist/index.ts`
  </verify>
  <done>
OptionsSheet and OptionsSheetRef exported from components/wishlist/index.ts
  </done>
</task>

</tasks>

<verification>
1. TypeScript compilation passes for OptionsSheet.tsx
2. OptionsSheet exports both component and ref type
3. Component follows established forwardRef pattern from LuxuryBottomSheet.tsx
4. All action handlers properly typed
5. Translation keys used for all user-visible text
</verification>

<success_criteria>
- OptionsSheet.tsx created with ~200+ lines
- Component exports OptionsSheetRef interface
- Preview section displays image OR placeholder based on item_type
- StarRating allows priority adjustment
- Share action uses React Native Share API
- Delete action shows Alert confirmation
- Edit action shows "coming soon" alert (safe fallback)
- All text uses translation keys
</success_criteria>

<output>
After completion, create `.planning/phases/36-options-sheet-polish/36-01-SUMMARY.md`
</output>
