---
phase: 09-favorite-marking
plan: 03
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - app/(app)/celebration/[id].tsx
  - lib/wishlistItems.ts
autonomous: true

must_haves:
  truths:
    - "User can see celebrant's wishlist items in the celebration info view"
    - "Celebrant's favorite item appears pinned to top of their wishlist"
    - "Favorite item shows MostWantedBadge and gold border"
    - "No heart icon appears (users cannot toggle others' favorites)"
    - "Special items display with correct type badges alongside Most Wanted badge"
  artifacts:
    - path: "app/(app)/celebration/[id].tsx"
      provides: "Celebration screen with celebrant's wishlist section"
      contains: "CelebrantWishlist"
    - path: "lib/wishlistItems.ts"
      provides: "Function to fetch wishlist items by user ID"
      exports: ["getWishlistItemsByUserId"]
  key_links:
    - from: "app/(app)/celebration/[id].tsx"
      to: "lib/favorites.ts"
      via: "getFavoriteForGroup to load celebrant's favorite"
      pattern: "getFavoriteForGroup"
    - from: "app/(app)/celebration/[id].tsx"
      to: "lib/wishlistItems.ts"
      via: "getWishlistItemsByUserId to load celebrant's items"
      pattern: "getWishlistItemsByUserId"
    - from: "app/(app)/celebration/[id].tsx"
      to: "components/wishlist/LuxuryWishlistCard.tsx"
      via: "renders cards with isFavorite prop"
      pattern: "isFavorite"
---

<objective>
Add celebrant's wishlist display to the celebration screen with favorite highlighting and pinned positioning.

Purpose: Honor the locked user decision that favorites must appear in BOTH My Wishlist AND celebrant event view. When group members view a celebration, they should see the celebrant's wishlist with their favorite item highlighted and pinned to top.

Output: Celebration info view shows a new "Celebrant's Wishlist" section displaying their wishlist items with favorite visual treatment (gold border, MostWantedBadge, pinned position).
</objective>

<execution_context>
@/home/zetaz/.claude/get-shit-done/workflows/execute-plan.md
@/home/zetaz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-favorite-marking/09-CONTEXT.md
@.planning/phases/09-favorite-marking/09-RESEARCH.md
@.planning/phases/09-favorite-marking/09-01-SUMMARY.md
@.planning/phases/09-favorite-marking/09-02-SUMMARY.md
@app/(app)/celebration/[id].tsx
@components/wishlist/LuxuryWishlistCard.tsx
@lib/favorites.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create function to fetch wishlist items by user ID</name>
  <files>lib/wishlistItems.ts</files>
  <action>
Add a new exported function to fetch wishlist items for a specific user:

```typescript
/**
 * Fetch wishlist items for a specific user
 * Used when viewing celebrant's wishlist in celebration view
 */
export async function getWishlistItemsByUserId(userId: string): Promise<WishlistItem[]> {
  const { data, error } = await supabase
    .from('wishlist_items')
    .select('*')
    .eq('user_id', userId)
    .order('priority', { ascending: false });

  if (error) {
    console.error('Failed to fetch wishlist items:', error);
    throw new Error(`Failed to fetch wishlist items: ${error.message}`);
  }

  return data || [];
}
```

If lib/wishlistItems.ts doesn't exist, create it with:
1. Import supabase from './supabase'
2. Import WishlistItem type (or define inline if needed)
3. The getWishlistItemsByUserId function

If the file exists, add this function to it following existing patterns.
  </action>
  <verify>
1. Function getWishlistItemsByUserId exists and is exported from lib/wishlistItems.ts
2. TypeScript compiles: `npx tsc --noEmit lib/wishlistItems.ts`
  </verify>
  <done>
- getWishlistItemsByUserId fetches items by user_id
- Returns items ordered by priority descending
- Error handling matches codebase patterns
  </done>
</task>

<task type="auto">
  <name>Task 2: Add celebrant's wishlist section to celebration screen</name>
  <files>app/(app)/celebration/[id].tsx</files>
  <action>
Add a "Celebrant's Wishlist" section to the celebration info view that displays the celebrant's wishlist items with favorite highlighting:

**1. Add Imports:**
```typescript
import { getFavoriteForGroup } from '../../../lib/favorites';
import { getWishlistItemsByUserId } from '../../../lib/wishlistItems';
import { LuxuryWishlistCard } from '../../../components/wishlist/LuxuryWishlistCard';
```

**2. Add State:**
```typescript
const [celebrantItems, setCelebrantItems] = useState<WishlistItem[]>([]);
const [celebrantFavoriteId, setCelebrantFavoriteId] = useState<string | null>(null);
const [wishlistLoading, setWishlistLoading] = useState(true);
```

**3. Load celebrant's wishlist and favorite in loadCelebration or separate effect:**
After celebration data is loaded (we have celebration.celebrant_id and celebration.group_id):

```typescript
// Load celebrant's wishlist items and their favorite
const loadCelebrantWishlist = async () => {
  if (!celebration?.celebrant_id || !celebration?.group_id) return;

  setWishlistLoading(true);
  try {
    const [items, favoriteId] = await Promise.all([
      getWishlistItemsByUserId(celebration.celebrant_id),
      getFavoriteForGroup(celebration.celebrant_id, celebration.group_id),
    ]);
    setCelebrantItems(items);
    setCelebrantFavoriteId(favoriteId);
  } catch (err) {
    console.error('Failed to load celebrant wishlist:', err);
  } finally {
    setWishlistLoading(false);
  }
};
```

Call loadCelebrantWishlist after celebration is loaded (in useEffect when celebration changes from null to data).

**4. Sort items with favorite pinned to top:**
```typescript
const sortedCelebrantItems = [...celebrantItems].sort((a, b) => {
  if (a.id === celebrantFavoriteId) return -1;
  if (b.id === celebrantFavoriteId) return 1;
  return (b.priority || 0) - (a.priority || 0);
});
```

**5. Add Wishlist Section in INFO VIEW (after Contributions section, before Gift Leader History):**
```tsx
{/* Celebrant's Wishlist Section */}
<View style={styles.section}>
  <View style={styles.sectionHeader}>
    <MaterialCommunityIcons name="gift" size={22} color="#8B1538" />
    <Text style={styles.sectionTitle}>{celebrantName}'s Wishlist</Text>
  </View>

  {wishlistLoading ? (
    <View style={styles.loadingCard}>
      <ActivityIndicator size="small" color="#8B1538" />
    </View>
  ) : sortedCelebrantItems.length === 0 ? (
    <View style={styles.emptyCard}>
      <Text style={styles.emptyText}>No wishlist items yet</Text>
    </View>
  ) : (
    <View style={styles.wishlistContainer}>
      {sortedCelebrantItems.map((item, index) => (
        <LuxuryWishlistCard
          key={item.id}
          item={item}
          index={index}
          isFavorite={item.id === celebrantFavoriteId}
          showFavoriteHeart={false}  // No heart - can't toggle others' favorites
        />
      ))}
    </View>
  )}
</View>
```

**6. Add styles for new section:**
```typescript
// Add to styles object
emptyCard: {
  backgroundColor: '#ffffff',
  borderRadius: 12,
  padding: 24,
  alignItems: 'center',
},
emptyText: {
  fontSize: 14,
  color: '#9ca3af',
},
wishlistContainer: {
  gap: 12,
},
```

Important:
- DO NOT show FavoriteHeart (showFavoriteHeart={false}) - users cannot toggle others' favorites
- The LuxuryWishlistCard with isFavorite=true will show gold border and MostWantedBadge automatically
- DO NOT pass onDelete or onToggleFavorite - these are viewer-only cards
  </action>
  <verify>
1. TypeScript compiles: `npx tsc --noEmit app/\(app\)/celebration/\[id\].tsx`
2. Celebrant's wishlist section exists in the info view
3. LuxuryWishlistCard used with isFavorite and showFavoriteHeart={false}
4. getFavoriteForGroup is called to load celebrant's favorite
  </verify>
  <done>
- Celebration info view shows "Celebrant's Wishlist" section
- Celebrant's favorite item (if any) appears first with gold border and MostWantedBadge
- No heart icons shown (users can't toggle others' favorites)
- Items sorted: favorite first, then by priority
- Loading and empty states handled
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. Visit a celebration page (where you are not the celebrant)
2. In the Info view, scroll down to find "Celebrant's Wishlist" section
3. Verify celebrant's wishlist items are displayed
4. If celebrant has a favorite, verify it appears first with:
   - Gold border (colors.gold[400])
   - "MOST WANTED" badge
   - Pinned to top of list
5. Verify NO heart icons appear on any cards
6. TypeScript compiles without errors
</verification>

<success_criteria>
- Celebrant's wishlist visible in celebration info view
- Celebrant's favorite item (if set) has gold border, MostWantedBadge, and is pinned to top
- No interactive elements (no heart icons, no delete buttons) on celebrant's cards
- Matches visual treatment from My Wishlist screen for consistency
- Empty state shown when celebrant has no wishlist items
</success_criteria>

<output>
After completion, create `.planning/phases/09-favorite-marking/09-03-SUMMARY.md`
</output>
