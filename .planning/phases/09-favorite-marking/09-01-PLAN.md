---
phase: 09-favorite-marking
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - lib/favorites.ts
  - components/wishlist/FavoriteHeart.tsx
  - components/wishlist/MostWantedBadge.tsx
autonomous: true

must_haves:
  truths:
    - "setFavorite function upserts to group_favorites table"
    - "removeFavorite function deletes from group_favorites table"
    - "getFavoriteForGroup returns item_id or null"
    - "FavoriteHeart component renders heart icon with pulse animation"
    - "MostWantedBadge component displays badge with gold accent color"
  artifacts:
    - path: "lib/favorites.ts"
      provides: "Favorite CRUD operations"
      exports: ["setFavorite", "removeFavorite", "getFavoriteForGroup"]
    - path: "components/wishlist/FavoriteHeart.tsx"
      provides: "Animated heart toggle component"
      exports: ["FavoriteHeart"]
    - path: "components/wishlist/MostWantedBadge.tsx"
      provides: "Most Wanted badge component"
      exports: ["MostWantedBadge"]
  key_links:
    - from: "lib/favorites.ts"
      to: "group_favorites table"
      via: "supabase upsert/delete"
      pattern: "supabase\\.from\\('group_favorites'\\)"
    - from: "components/wishlist/FavoriteHeart.tsx"
      to: "moti"
      via: "MotiView for animation"
      pattern: "MotiView"
---

<objective>
Create the favorites service layer and UI components for the "Most Wanted" feature.

Purpose: Build reusable foundation for favorite marking - the data operations and visual components that will be integrated into the wishlist screens.

Output: Three files - favorites service with CRUD operations, animated heart toggle component, and "Most Wanted" badge component.
</objective>

<execution_context>
@/home/zetaz/.claude/get-shit-done/workflows/execute-plan.md
@/home/zetaz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-favorite-marking/09-CONTEXT.md
@.planning/phases/09-favorite-marking/09-RESEARCH.md
@lib/contributions.ts
@components/wishlist/ItemTypeBadge.tsx
@constants/theme.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create favorites service</name>
  <files>lib/favorites.ts</files>
  <action>
Create a new favorites service following the existing pattern from lib/contributions.ts:

1. Import supabase from './supabase'
2. Export three async functions:

**setFavorite(userId: string, groupId: string, itemId: string): Promise<void>**
- Uses upsert with onConflict: 'user_id,group_id' to atomically replace existing favorite
- Includes updated_at timestamp
- Throws descriptive error on failure

**removeFavorite(userId: string, groupId: string): Promise<void>**
- Deletes the favorite record matching user_id and group_id
- Throws descriptive error on failure

**getFavoriteForGroup(userId: string, groupId: string): Promise<string | null>**
- Selects item_id from group_favorites where user_id and group_id match
- Returns item_id or null if no favorite exists
- Handles PGRST116 (no rows) gracefully by returning null

Follow error handling pattern from contributions.ts:
- console.error for logging
- throw new Error with descriptive message

Add JSDoc comments matching codebase style (single line /** description */).
  </action>
  <verify>
1. File exists at lib/favorites.ts
2. TypeScript compiles without errors: `npx tsc --noEmit lib/favorites.ts`
3. All three functions are exported
  </verify>
  <done>
- setFavorite uses upsert with onConflict: 'user_id,group_id'
- removeFavorite uses delete with eq filters
- getFavoriteForGroup returns item_id or null
- Error handling matches codebase pattern
  </done>
</task>

<task type="auto">
  <name>Task 2: Create FavoriteHeart component</name>
  <files>components/wishlist/FavoriteHeart.tsx</files>
  <action>
Create animated heart toggle component following LuxuryWishlistCard patterns:

```typescript
interface FavoriteHeartProps {
  isFavorite: boolean;
  onPress: () => void;
  disabled?: boolean;
}
```

Implementation:
1. Import TouchableOpacity from react-native
2. Import MotiView from 'moti'
3. Import MaterialCommunityIcons from '@expo/vector-icons'
4. Import colors from '../../constants/theme'

5. Return TouchableOpacity wrapping MotiView wrapping icon:
   - TouchableOpacity: onPress={onPress}, disabled={disabled}
   - MotiView:
     - Use key={isFavorite ? 'filled' : 'outline'} to trigger animation on change
     - animate={{ scale: [1, 1.2, 1] }} for pulse effect
     - transition={{ type: 'spring', damping: 15, stiffness: 300 }}
   - MaterialCommunityIcons:
     - name={isFavorite ? 'heart' : 'heart-outline'}
     - size={24}
     - color={isFavorite ? colors.gold[500] : colors.burgundy[300]}

Export as named export: `export function FavoriteHeart`
Also add default export for flexibility.
  </action>
  <verify>
1. File exists at components/wishlist/FavoriteHeart.tsx
2. TypeScript compiles: `npx tsc --noEmit components/wishlist/FavoriteHeart.tsx`
3. Component is exported
  </verify>
  <done>
- Component accepts isFavorite, onPress, disabled props
- Uses MotiView with spring animation for pulse effect
- Heart icon toggles between filled (gold) and outline (burgundy)
- Animation triggers on isFavorite change via key prop
  </done>
</task>

<task type="auto">
  <name>Task 3: Create MostWantedBadge component</name>
  <files>components/wishlist/MostWantedBadge.tsx</files>
  <action>
Create badge component following ItemTypeBadge.tsx pattern:

1. Import View, Text from 'react-native'
2. Import colors, spacing, borderRadius from '../../constants/theme'

3. Create simple functional component with no props:

Style matching ItemTypeBadge but using gold accent:
- Container View:
  - backgroundColor: colors.gold[100]
  - paddingHorizontal: spacing.sm
  - paddingVertical: spacing.xs / 2
  - borderRadius: borderRadius.sm
  - alignSelf: 'flex-start'
  - marginBottom: spacing.xs

- Text:
  - color: colors.gold[700]
  - fontSize: 11
  - fontWeight: '600'
  - letterSpacing: 0.3
  - content: "MOST WANTED"

Export as named export: `export function MostWantedBadge`
Also add default export.
  </action>
  <verify>
1. File exists at components/wishlist/MostWantedBadge.tsx
2. TypeScript compiles: `npx tsc --noEmit components/wishlist/MostWantedBadge.tsx`
3. Component is exported
  </verify>
  <done>
- Badge displays "MOST WANTED" text
- Uses gold[100] background with gold[700] text (cohesive accent treatment)
- Styling matches ItemTypeBadge patterns for consistency
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. All three files exist and compile without TypeScript errors
2. Imports resolve correctly (test with `npx tsc --noEmit` on each file)
3. Code follows codebase conventions (single quotes, named exports, JSDoc comments)
</verification>

<success_criteria>
- lib/favorites.ts exports setFavorite, removeFavorite, getFavoriteForGroup
- components/wishlist/FavoriteHeart.tsx exports animated heart toggle
- components/wishlist/MostWantedBadge.tsx exports gold-accented badge
- All files compile without TypeScript errors
- Patterns match existing codebase (contributions.ts, ItemTypeBadge.tsx)
</success_criteria>

<output>
After completion, create `.planning/phases/09-favorite-marking/09-01-SUMMARY.md`
</output>
