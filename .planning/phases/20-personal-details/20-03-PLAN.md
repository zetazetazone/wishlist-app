---
phase: 20-personal-details
plan: 03
type: execute
wave: 3
depends_on: ["20-02"]
files_modified:
  - app/(app)/settings/profile.tsx
  - app/(app)/member/[id].tsx
  - components/profile/PersonalDetailsReadOnly.tsx
autonomous: true

must_haves:
  truths:
    - "Profile settings shows link to personal details with completeness preview"
    - "Group members can view another member's personal details"
    - "Member profile shows sizes, preferences, and external links read-only"
    - "Profile shows last updated timestamp"
  artifacts:
    - path: "app/(app)/member/[id].tsx"
      provides: "Read-only member profile view"
    - path: "components/profile/PersonalDetailsReadOnly.tsx"
      provides: "Read-only display component"
      exports: ["PersonalDetailsReadOnly"]
    - path: "app/(app)/settings/profile.tsx"
      provides: "Updated profile with personal details link"
  key_links:
    - from: "app/(app)/member/[id].tsx"
      to: "lib/personalDetails.ts"
      via: "getPersonalDetails for member data"
      pattern: "import.*getPersonalDetails"
    - from: "app/(app)/settings/profile.tsx"
      to: "app/(app)/settings/personal-details.tsx"
      via: "router.push navigation"
      pattern: "router\\.push.*personal-details"
---

<objective>
Integrate personal details into profile settings and create read-only member profile view

Purpose: Complete PROF-06 (global sharing), PROF-07 (member viewing), PROF-08 (completeness indicator), and PROF-09 (last updated timestamp) by adding integrations.

Output: Updated profile settings with personal details link, and a member profile screen for viewing others' details.
</objective>

<execution_context>
@/home/zetaz/.claude/get-shit-done/workflows/execute-plan.md
@/home/zetaz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/20-personal-details/20-01-SUMMARY.md (CompletenessIndicator, TagChip)
@.planning/phases/20-personal-details/20-02-SUMMARY.md (form sections, personal-details screen)
@app/(app)/settings/profile.tsx (existing profile screen)
@lib/personalDetails.ts (getPersonalDetails)
@components/profile/ExternalLinkRow.tsx (for read-only link display)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create read-only personal details component</name>
  <files>
    components/profile/PersonalDetailsReadOnly.tsx
  </files>
  <action>
Create a read-only display component for viewing another member's personal details:

**Props:**
```typescript
interface PersonalDetailsReadOnlyProps {
  sizes: PersonalSizes;
  preferences: PersonalPreferences;
  externalLinks: ExternalLink[];
  updatedAt?: string;  // ISO timestamp
}
```

**Display sections:**

1. **Last Updated** (if updatedAt provided):
   - Use date-fns formatDistanceToNow: "Updated 3 days ago"
   - Gray text, small font

2. **Sizes Section:**
   - Heading "Clothing Sizes"
   - Grid/table layout showing: Shirt, Pants, Shoe, Ring
   - Only show fields that have values
   - If no sizes filled, show "No sizes added yet" in gray

3. **Preferences Section:**
   - Heading "Preferences"
   - SubHeading for each category (only if has tags):
     - "Favorite Colors" with color chips
     - "Favorite Brands" with brand chips
     - "Interests" with interest chips
     - "Dislikes" with warning-colored chips
   - Use TagChip (no onRemove, just display)
   - If no preferences, show "No preferences added yet"

4. **External Wishlists Section:**
   - Heading "External Wishlists"
   - List of ExternalLinkRow components (with onOpen, no onRemove)
   - If no links, show "No external wishlists added"

**Styling:**
- Card-style sections with shadows (follow BudgetProgressBar pattern)
- Consistent spacing using theme
- Empty state text in gray/muted color
  </action>
  <verify>
- TypeScript compiles: `npx tsc --noEmit`
- Component exports PersonalDetailsReadOnly
  </verify>
  <done>
- Read-only display shows all filled personal details
- Empty sections show appropriate placeholder
- External links open in device browser
- Last updated timestamp formats correctly
  </done>
</task>

<task type="auto">
  <name>Task 2: Create member profile screen and update profile settings</name>
  <files>
    app/(app)/member/[id].tsx
    app/(app)/settings/profile.tsx
  </files>
  <action>
**app/(app)/member/[id].tsx:**

Create read-only member profile screen:

```typescript
import { useLocalSearchParams, useRouter, Stack } from 'expo-router';
import { useState, useEffect } from 'react';
import { ScrollView, Alert } from 'react-native';
import { VStack, Heading, Text, Avatar, AvatarImage, AvatarFallbackText } from '@gluestack-ui/themed';
import { supabase } from '@/lib/supabase';
import { getPersonalDetails, TypedPersonalDetails } from '@/lib/personalDetails';
import { getAvatarUrl } from '@/lib/storage';
import { CompletenessIndicator } from '@/components/profile/CompletenessIndicator';
import { PersonalDetailsReadOnly } from '@/components/profile/PersonalDetailsReadOnly';
import { calculateCompleteness } from '@/lib/profileCompleteness';
```

**State:**
- isLoading: boolean
- memberProfile: { id, display_name, avatar_url } | null
- personalDetails: TypedPersonalDetails | null

**Load on mount:**
1. Get memberId from params: `const { id } = useLocalSearchParams<{ id: string }>();`
2. Fetch member's user_profile for name/avatar
3. Fetch member's personal_details via getPersonalDetails(id)
4. Calculate completeness from details

**Display:**
- Stack.Screen with title (member name or "Profile")
- Avatar and display name header
- CompletenessIndicator if details exist
- PersonalDetailsReadOnly if details exist
- If no details: "This member hasn't added personal details yet"

**app/(app)/settings/profile.tsx updates:**

Add a new section after the Birthday field:

```typescript
{/* Personal Details Link */}
<Pressable
  onPress={() => router.push('/settings/personal-details')}
  style={{ marginTop: spacing.lg }}
>
  <Box
    backgroundColor="$white"
    borderRadius="$lg"
    padding="$4"
    borderWidth={1}
    borderColor="$borderLight200"
  >
    <HStack justifyContent="space-between" alignItems="center">
      <VStack>
        <Text fontWeight="$semibold">Personal Details</Text>
        <Text fontSize="$xs" color="$textLight500">
          Sizes, preferences & wishlists
        </Text>
      </VStack>
      <HStack alignItems="center" space="sm">
        {/* Show mini completeness badge */}
        <Text fontSize="$sm" color="$textLight500">
          {completeness?.percentage ?? 0}%
        </Text>
        <MaterialCommunityIcons name="chevron-right" size={20} color="#9CA3AF" />
      </HStack>
    </HStack>
  </Box>
</Pressable>
```

Add state and effect to load completeness:
```typescript
const [completeness, setCompleteness] = useState<CompletenessResult | null>(null);

// In loadProfile, after loading profile:
const details = await getPersonalDetails(user.id);
if (details) {
  setCompleteness(calculateCompleteness(details.sizes, details.preferences, details.external_links));
}
```

Add imports for calculateCompleteness, getPersonalDetails, CompletenessResult.
  </action>
  <verify>
- TypeScript compiles: `npx tsc --noEmit`
- Member profile screen exists at app/(app)/member/[id].tsx
- Profile settings has clickable "Personal Details" link
  </verify>
  <done>
- Profile settings shows personal details link with completeness percentage
- Member profile screen loads and displays another user's personal details
- Navigation from profile to personal-details works
- PROF-07 (view another member's details) complete
- PROF-09 (last updated timestamp) complete
  </done>
</task>

</tasks>

<verification>
- All 3 files created/modified correctly
- No TypeScript errors
- Navigation flow: Profile -> Personal Details edit screen works
- Member profile shows read-only details
- Empty states handled for users with no details
</verification>

<success_criteria>
- PROF-06: Personal details visible across groups (RLS handles this, UI enables viewing)
- PROF-07: Group members can view another member's personal details via member profile
- PROF-08: Completeness indicator shows on profile settings card
- PROF-09: Last updated timestamp displays on member profile
- All requirements PROF-01 through PROF-09 fully implemented
</success_criteria>

<output>
After completion, create `.planning/phases/20-personal-details/20-03-SUMMARY.md`
</output>
