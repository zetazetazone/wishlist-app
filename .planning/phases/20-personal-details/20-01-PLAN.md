---
phase: 20-personal-details
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - components/profile/TagChip.tsx
  - components/profile/TagInput.tsx
  - components/profile/CompletenessIndicator.tsx
  - lib/profileCompleteness.ts
autonomous: true

must_haves:
  truths:
    - "Tag chips display with label and optional delete button"
    - "Tag input accepts predefined options and custom text"
    - "Completeness percentage calculates from filled sections"
    - "Completeness indicator displays progress visually"
  artifacts:
    - path: "components/profile/TagChip.tsx"
      provides: "Single tag display component"
      exports: ["TagChip"]
    - path: "components/profile/TagInput.tsx"
      provides: "Tag input with predefined + custom options"
      exports: ["TagInput"]
    - path: "lib/profileCompleteness.ts"
      provides: "Completeness calculation logic"
      exports: ["calculateCompleteness", "CompletenessResult"]
    - path: "components/profile/CompletenessIndicator.tsx"
      provides: "Visual progress indicator"
      exports: ["CompletenessIndicator"]
  key_links:
    - from: "components/profile/TagInput.tsx"
      to: "components/profile/TagChip.tsx"
      via: "imports TagChip"
      pattern: "import.*TagChip"
    - from: "components/profile/CompletenessIndicator.tsx"
      to: "lib/profileCompleteness.ts"
      via: "imports CompletenessResult type"
      pattern: "import.*CompletenessResult"
---

<objective>
Build reusable foundation components for personal details: TagChip, TagInput, and CompletenessIndicator

Purpose: These components are building blocks used by the form sections (Plan 02) and the read-only view (Plan 03). Building them first enables parallel development.

Output: Four files providing tag management UI and profile completeness calculation.
</objective>

<execution_context>
@/home/zetaz/.claude/get-shit-done/workflows/execute-plan.md
@/home/zetaz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/20-personal-details/20-RESEARCH.md
@types/database.types.ts (PersonalSizes, PersonalPreferences, PreferenceTag, ExternalLink interfaces)
@constants/theme.ts (colors, spacing, borderRadius, shadows)
@components/groups/BudgetProgressBar.tsx (progress bar pattern)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TagChip and TagInput components</name>
  <files>
    components/profile/TagChip.tsx
    components/profile/TagInput.tsx
  </files>
  <action>
Create components/profile/ directory and two components:

**TagChip.tsx:**
- Props: `{ label: string; isCustom?: boolean; onRemove?: () => void; selectable?: boolean }`
- Display: Rounded chip with label text, optional delete X icon on right
- Styling: Use burgundy colors from theme, custom tags get slightly different border
- If `selectable` is true, show as unselected option (lighter color, no X)
- If `onRemove` provided, show X icon that calls onRemove on press
- Use TouchableOpacity for the delete button area

**TagInput.tsx:**
- Props: `{ tags: PreferenceTag[]; onChange: (tags: PreferenceTag[]) => void; predefinedOptions?: string[]; placeholder?: string; maxTags?: number }`
- Import PreferenceTag from types/database.types
- Display:
  1. Selected tags row (wrap flexWrap) using TagChip with onRemove
  2. Predefined options row (unselected only) using TagChip with selectable
  3. Custom input field (Input from gluestack-ui)
- Behavior:
  - Clicking predefined option adds it as { label, custom: false }
  - Typing in input + Enter adds as { label, custom: true }
  - Case-insensitive duplicate check: `tags.some(t => t.label.toLowerCase() === label.toLowerCase())`
  - Respect maxTags (default 20)
- Use VStack/HStack from gluestack-ui for layout
  </action>
  <verify>
- TypeScript compiles: `npx tsc --noEmit`
- Files exist in components/profile/
- Imports resolve correctly
  </verify>
  <done>
- TagChip renders label with optional delete button
- TagInput shows selected tags, predefined options, and custom input
- Case-insensitive duplicate prevention works
  </done>
</task>

<task type="auto">
  <name>Task 2: Create completeness calculation and indicator</name>
  <files>
    lib/profileCompleteness.ts
    components/profile/CompletenessIndicator.tsx
  </files>
  <action>
**lib/profileCompleteness.ts:**
```typescript
import type { PersonalSizes, PersonalPreferences, ExternalLink } from '../types/database.types';

export interface CompletenessResult {
  percentage: number;
  filledCount: number;
  totalCount: number;
  missingSections: string[];
}

export function calculateCompleteness(
  sizes: PersonalSizes,
  preferences: PersonalPreferences,
  externalLinks: ExternalLink[]
): CompletenessResult {
  const sections = [
    { name: 'Clothing sizes', filled: Object.values(sizes).some(v => v && v.trim()) },
    { name: 'Favorite colors', filled: (preferences.colors?.length || 0) > 0 },
    { name: 'Favorite brands', filled: (preferences.brands?.length || 0) > 0 },
    { name: 'Interests', filled: (preferences.interests?.length || 0) > 0 },
    { name: 'Dislikes', filled: (preferences.dislikes?.length || 0) > 0 },
    { name: 'External wishlists', filled: externalLinks.length > 0 },
  ];

  const filled = sections.filter(s => s.filled);
  const missing = sections.filter(s => !s.filled).map(s => s.name);

  return {
    percentage: Math.round((filled.length / sections.length) * 100),
    filledCount: filled.length,
    totalCount: sections.length,
    missingSections: missing,
  };
}
```

**CompletenessIndicator.tsx:**
- Props: `{ result: CompletenessResult }`
- Display: Follow BudgetProgressBar pattern
  - Card container with shadow
  - Header row with icon (MaterialCommunityIcons "account-check") and "Profile Completeness" text
  - Horizontal progress bar showing percentage filled
  - Text showing "{filledCount} of {totalCount} sections"
- Color coding:
  - >= 80%: colors.success (green)
  - >= 50%: colors.warning (yellow)
  - < 50%: colors.burgundy[400]
- Use MotiView for fade-in animation (like BudgetProgressBar)
- Use StyleSheet for styles following project pattern
  </action>
  <verify>
- TypeScript compiles: `npx tsc --noEmit`
- calculateCompleteness({ shirt: 'M' }, { colors: [{ label: 'Red' }] }, []) returns percentage ~33%
  </verify>
  <done>
- calculateCompleteness returns correct percentage based on filled sections
- CompletenessIndicator displays progress bar with color coding
- Empty state (0%) displays correctly
  </done>
</task>

</tasks>

<verification>
- All 4 files exist in correct locations
- No TypeScript errors: `npx tsc --noEmit`
- Components follow project patterns (gluestack-ui, NativeWind, theme colors)
- No new dependencies added
</verification>

<success_criteria>
- TagChip and TagInput are reusable for PROF-02 (colors), PROF-03 (brands, interests), PROF-04 (dislikes)
- CompletenessIndicator satisfies PROF-08 (completeness indicator)
- Components are ready for use in Plan 02 form sections
</success_criteria>

<output>
After completion, create `.planning/phases/20-personal-details/20-01-SUMMARY.md`
</output>
