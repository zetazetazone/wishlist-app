---
phase: 25-friend-requests-flow
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - components/friends/FriendRequestCard.tsx
  - app/(app)/requests.tsx
autonomous: true

must_haves:
  truths:
    - "User can view pending friend requests (both incoming and outgoing)"
    - "User can accept an incoming friend request"
    - "User can decline an incoming friend request"
    - "User can cancel an outgoing friend request"
    - "User can block a user when declining a request"
  artifacts:
    - path: "components/friends/FriendRequestCard.tsx"
      provides: "Friend request card with accept/decline/cancel actions"
      min_lines: 80
    - path: "app/(app)/requests.tsx"
      provides: "Requests screen with incoming/outgoing tabs"
      min_lines: 120
  key_links:
    - from: "app/(app)/requests.tsx"
      to: "lib/friends.ts"
      via: "service function imports"
      pattern: "import.*getPendingRequests.*from"
    - from: "FriendRequestCard.tsx"
      to: "lib/friends.ts"
      via: "passed callbacks from screen"
      pattern: "onAccept|onDecline|onCancel"
---

<objective>
Pending requests screen with incoming/outgoing tabs

Purpose: Create the Requests screen where users view and manage pending friend requests. Incoming requests show Accept/Decline buttons. Outgoing requests show Cancel button. Segment control toggles between views.

Output: FriendRequestCard component, requests.tsx screen with tab navigation
</objective>

<execution_context>
@/home/zetaz/.claude/get-shit-done/workflows/execute-plan.md
@/home/zetaz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/25-friend-requests-flow/25-RESEARCH.md
@.planning/phases/24-friend-core-services-tab/24-01-SUMMARY.md
@components/friends/FriendCard.tsx
@app/(app)/(tabs)/friends.tsx
@constants/theme.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create FriendRequestCard component</name>
  <files>components/friends/FriendRequestCard.tsx</files>
  <action>
Create FriendRequestCard.tsx in components/friends/ following FriendCard pattern:

**Props interface:**
```typescript
interface FriendRequestCardProps {
  request: FriendRequestWithProfile;
  type: 'incoming' | 'outgoing';
  onAccept?: (requestId: string) => void;
  onDecline?: (requestId: string) => void;
  onCancel?: (requestId: string) => void;
}
```

**Visual design (match FriendCard):**
- MotiView wrapper with staggered animation (delay prop * index)
- White background with gold[100] border, borderRadius.lg
- 56x56 avatar with fallback to initials
- Display name (or "Unknown" if null)
- Relative time: "Sent 2 hours ago" using date-fns formatDistanceToNow

**Action buttons:**
- Incoming: Two buttons side-by-side
  - Accept: Green background (colors.green[600]), white text, calls onAccept
  - Decline: Gray/red outline, calls onDecline
- Outgoing: Single button
  - Cancel: Red/gray text button, calls onCancel

**Time display:**
- Use date-fns formatDistanceToNow(new Date(request.created_at), { addSuffix: true })
- Example: "2 hours ago", "3 days ago"

Import colors, spacing, borderRadius, shadows from theme.
Use MaterialCommunityIcons for button icons if desired (check, close, cancel).
  </action>
  <verify>
Verify component structure:
- grep "FriendRequestCardProps" components/friends/FriendRequestCard.tsx
- grep "onAccept" components/friends/FriendRequestCard.tsx
- grep "onDecline" components/friends/FriendRequestCard.tsx
- grep "formatDistanceToNow" components/friends/FriendRequestCard.tsx
- File exists and has >80 lines
  </verify>
  <done>
FriendRequestCard displays request sender/receiver profile with avatar, name, time, and action buttons. Incoming requests show Accept/Decline, outgoing show Cancel. Follows FriendCard visual pattern with staggered animations.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create requests screen with tabs</name>
  <files>app/(app)/requests.tsx</files>
  <action>
Create requests.tsx in app/(app)/ (non-tab modal-style screen):

**Screen structure:**
- Stack.Screen with title "Friend Requests"
- LinearGradient header (matching friends.tsx pattern)
- Segment control for Incoming / Outgoing toggle
- FlashList for request cards
- Empty state for each tab

**State:**
```typescript
const [activeTab, setActiveTab] = useState<'incoming' | 'outgoing'>('incoming');
const [incoming, setIncoming] = useState<FriendRequestWithProfile[]>([]);
const [outgoing, setOutgoing] = useState<FriendRequestWithProfile[]>([]);
const [loading, setLoading] = useState(true);
```

**Data loading:**
- useFocusEffect to load requests when screen focuses
- Call getPendingRequests() from lib/friends
- Set incoming and outgoing state from result

**Segment control:**
- Two buttons side-by-side: "Incoming (N)" and "Outgoing (N)"
- Active tab has filled background, inactive has outline
- Badge count from array lengths
- Uses colors from theme (burgundy for active, gray for inactive)

**Action handlers:**
- handleAccept: Call acceptFriendRequest, reload list, show success toast/alert
- handleDecline: Show Alert with "Decline" and "Block & Decline" options
  - Decline: Call declineFriendRequest
  - Block & Decline: Call blockUser
  - Reload list after either
- handleCancel: Confirm via Alert, call cancelFriendRequest, reload list

**Empty states:**
- Incoming: "No pending requests" with icon
- Outgoing: "No sent requests" with icon

**Error handling:**
- Wrap actions in try/catch
- Alert.alert on error with error.message
  </action>
  <verify>
Verify screen structure:
- grep "getPendingRequests" app/\(app\)/requests.tsx
- grep "acceptFriendRequest" app/\(app\)/requests.tsx
- grep "declineFriendRequest" app/\(app\)/requests.tsx
- grep "FriendRequestCard" app/\(app\)/requests.tsx
- grep "activeTab" app/\(app\)/requests.tsx
- File exists and has >120 lines
  </verify>
  <done>
Requests screen displays incoming and outgoing friend requests in separate tabs. Incoming tab shows Accept/Decline buttons, outgoing shows Cancel. Block option available in decline flow. Screen follows friends.tsx visual pattern with gradient header.
  </done>
</task>

</tasks>

<verification>
After both tasks complete:

1. **Component verified:**
   - FriendRequestCard exists with correct props interface
   - Renders avatar, name, time, and appropriate action buttons
   - Follows FriendCard visual pattern

2. **Screen verified:**
   - requests.tsx exists with segment control for tabs
   - Loads and displays incoming/outgoing requests
   - Accept, decline, cancel, and block actions work
   - Empty states display when no requests

3. **Navigation ready:**
   - Screen accessible at /requests route (expo-router)
   - Will be linked from Friends tab header in plan 03
</verification>

<success_criteria>
- FriendRequestCard component created with action callbacks
- Requests screen created with incoming/outgoing tabs
- Accept/decline/cancel/block flows implemented
- Empty states for both tabs
- Visual design matches existing friends tab
</success_criteria>

<output>
After completion, create `.planning/phases/25-friend-requests-flow/25-02-SUMMARY.md`
</output>
