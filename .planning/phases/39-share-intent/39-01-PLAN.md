---
phase: 39-share-intent
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - app.json
  - patches/xcode+3.0.1.patch
autonomous: true

must_haves:
  truths:
    - "expo-share-intent package installed with correct version"
    - "patch-package handles xcode prebuild bug"
    - "app.json configures iOS activation rules for URL content"
    - "app.json configures Android intent filters for text content"
  artifacts:
    - path: "patches/xcode+3.0.1.patch"
      provides: "xcode prebuild fix"
      contains: "pbxProject.js"
    - path: "package.json"
      provides: "expo-share-intent dependency"
      contains: "expo-share-intent"
    - path: "app.json"
      provides: "Share intent plugin configuration"
      contains: "expo-share-intent"
  key_links:
    - from: "package.json"
      to: "patches/xcode+3.0.1.patch"
      via: "postinstall script"
      pattern: "patch-package"
---

<objective>
Configure expo-share-intent plugin with required patches and native settings

Purpose: Enable iOS Share Extension and Android Intent Filters for receiving shared URLs
Output: Configured app.json, installed dependencies, xcode patch for prebuild
</objective>

<execution_context>
@/home/zetaz/.claude/get-shit-done/workflows/execute-plan.md
@/home/zetaz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/39-share-intent/39-RESEARCH.md
@app.json
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dependencies and create xcode patch</name>
  <files>package.json, patches/xcode+3.0.1.patch</files>
  <action>
1. Install expo-share-intent v5.1.1 and patch-package:
   ```bash
   npm install expo-share-intent@^5.1.1
   npm install --save-dev patch-package
   ```

2. Create patches directory and xcode patch file at `patches/xcode+3.0.1.patch`:
   ```diff
   diff --git a/node_modules/xcode/lib/pbxProject.js b/node_modules/xcode/lib/pbxProject.js
   index 1234567..abcdefg 100644
   --- a/node_modules/xcode/lib/pbxProject.js
   +++ b/node_modules/xcode/lib/pbxProject.js
   @@ -1678,7 +1678,7 @@ function correctForPath(project, group) {
   -    if (project.pbxGroupByName(group).path)
   +    if (project.pbxGroupByName(group) && project.pbxGroupByName(group).path)
   ```
   NOTE: Get the exact patch from expo-share-intent example repo if above is incomplete.

3. Add postinstall script to package.json scripts:
   ```json
   "postinstall": "patch-package"
   ```

4. Run postinstall to apply patch:
   ```bash
   npm run postinstall
   ```
  </action>
  <verify>
- `npm ls expo-share-intent` shows ^5.1.1 installed
- `cat patches/xcode+3.0.1.patch` shows patch file exists
- `grep postinstall package.json` shows patch-package script
- `npm run postinstall` completes without error
  </verify>
  <done>expo-share-intent installed, patch-package configured, xcode patch in place</done>
</task>

<task type="auto">
  <name>Task 2: Configure app.json for share intent</name>
  <files>app.json</files>
  <action>
Add expo-share-intent to plugins array in app.json with configuration:

```json
[
  "expo-share-intent",
  {
    "iosActivationRules": {
      "NSExtensionActivationSupportsWebURLWithMaxCount": 1,
      "NSExtensionActivationSupportsWebPageWithMaxCount": 1
    },
    "androidIntentFilters": ["text/*"],
    "androidMainActivityAttributes": {
      "android:launchMode": "singleTask"
    }
  }
]
```

Place after existing plugins (expo-router, expo-notifications, etc.) in the plugins array.

The configuration:
- `NSExtensionActivationSupportsWebURLWithMaxCount: 1` enables iOS sharing of direct URLs
- `NSExtensionActivationSupportsWebPageWithMaxCount: 1` enables iOS sharing from Safari/Chrome
- `androidIntentFilters: ["text/*"]` enables Android ACTION_SEND for text/URLs
- `android:launchMode: "singleTask"` ensures single app instance handles shares
  </action>
  <verify>
- `cat app.json | grep expo-share-intent` shows plugin configured
- JSON is valid: `node -e "require('./app.json')"`
  </verify>
  <done>app.json configured with iOS activation rules and Android intent filters</done>
</task>

</tasks>

<verification>
- [ ] expo-share-intent@^5.1.1 in package.json dependencies
- [ ] patch-package in package.json devDependencies
- [ ] postinstall script exists in package.json
- [ ] patches/xcode+3.0.1.patch exists with pbxProject fix
- [ ] app.json includes expo-share-intent plugin with correct config
- [ ] `npm run postinstall` runs successfully
</verification>

<success_criteria>
Native configuration complete - iOS Share Extension activation rules and Android Intent Filters ready for prebuild. Next plan will integrate ShareIntentProvider.
</success_criteria>

<output>
After completion, create `.planning/phases/39-share-intent/39-01-SUMMARY.md`
</output>
