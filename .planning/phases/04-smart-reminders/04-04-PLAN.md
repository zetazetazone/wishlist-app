---
phase: 04-smart-reminders
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - app/(app)/_layout.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Timezone is automatically detected and saved to users.timezone column"
  artifacts:
    - path: "app/(app)/_layout.tsx"
      provides: "Push notification + timezone hook integration"
      contains: "usePushNotifications"
  key_links:
    - from: "app/(app)/_layout.tsx"
      to: "hooks/usePushNotifications.ts"
      via: "import and hook call"
      pattern: "usePushNotifications\\(\\)"
---

<objective>
Integrate usePushNotifications hook to enable automatic timezone detection

Purpose: The hook exists with working timezone detection (saveUserTimezone) but is never used. This causes user timezone to remain at default UTC instead of being detected and saved.

Output: Hook integrated in (app) layout so timezone is saved when authenticated users open the app.
</objective>

<execution_context>
@/home/zetaz/.claude/get-shit-done/workflows/execute-plan.md
@/home/zetaz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@app/(app)/_layout.tsx - Target file, renders for authenticated users
@hooks/usePushNotifications.ts - Hook with saveUserTimezone() that needs to be called
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add usePushNotifications hook to app layout</name>
  <files>app/(app)/_layout.tsx</files>
  <action>
    1. Import usePushNotifications from '../../hooks/usePushNotifications'
    2. Call usePushNotifications() at the top of the AppLayout component

    The hook runs its useEffect on mount which:
    - Checks if user is authenticated (they will be - this layout only renders post-auth)
    - Calls saveUserTimezone() to detect and save timezone to users.timezone
    - Registers for push notifications and saves token

    No need to use the return values (expoPushToken, notification) unless needed elsewhere.
    Simply calling the hook is sufficient to trigger the timezone save.
  </action>
  <verify>
    1. TypeScript compiles: `npx tsc --noEmit` (or existing type check)
    2. App builds: `npx expo start` runs without errors
    3. Manual test: Open app while authenticated, check Supabase users table for timezone value
  </verify>
  <done>
    - usePushNotifications hook is imported and called in app/(app)/_layout.tsx
    - Authenticated users get their timezone saved on app open
  </done>
</task>

</tasks>

<verification>
- [ ] Hook import added to app/(app)/_layout.tsx
- [ ] Hook called inside AppLayout component
- [ ] No TypeScript errors
- [ ] App runs without crashes
</verification>

<success_criteria>
When an authenticated user opens the app, their device timezone is detected via Intl API and saved to the users.timezone column in Supabase.
</success_criteria>

<output>
After completion, create `.planning/phases/04-smart-reminders/04-04-SUMMARY.md`
</output>
