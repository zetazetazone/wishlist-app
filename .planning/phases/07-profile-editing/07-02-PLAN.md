---
phase: 07-profile-editing
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - app/(onboarding)/index.tsx
autonomous: true

must_haves:
  truths:
    - "User sees birthday confirmation step during onboarding"
    - "Onboarding confirmation clearly explains birthday cannot be changed later"
  artifacts:
    - path: "app/(onboarding)/index.tsx"
      provides: "Onboarding flow with birthday confirmation step"
      contains: "cannot be changed"
  key_links:
    - from: "app/(onboarding)/index.tsx (confirmation step)"
      to: "app/(onboarding)/index.tsx (save handler)"
      via: "state transition on confirm"
      pattern: "setStep.*confirm|showConfirmation"
---

<objective>
Add birthday confirmation step to onboarding flow that clearly warns users their birthday cannot be changed after setup.

Purpose: Fulfills ONBD-01 and ONBD-02 requirements - users must explicitly confirm their birthday with a clear warning before it becomes permanent.

Output: Modified onboarding flow with a dedicated confirmation step before saving.
</objective>

<execution_context>
@/home/zetaz/.claude/get-shit-done/workflows/execute-plan.md
@/home/zetaz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-profile-editing/07-RESEARCH.md

# File to modify
@app/(onboarding)/index.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add birthday confirmation step to onboarding</name>
  <files>app/(onboarding)/index.tsx</files>
  <action>
Modify the onboarding flow to include a confirmation step before saving:

1. Add state for step management:
   - `const [step, setStep] = useState<'form' | 'confirm'>('form');`

2. Modify handleContinue:
   - Instead of saving immediately, first transition to confirmation step
   - Rename current handleContinue to handleConfirmAndSave
   - Create new handleContinue that validates fields and sets step to 'confirm'

3. Add confirmation UI when step === 'confirm':
   - Large formatted birthday display: `birthday.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })`
   - Warning box with amber/warning colors:
     - Background: $amber100 or backgroundColor="#FEF3C7"
     - Border: $amber300 or borderColor="#FCD34D"
     - Icon: MaterialCommunityIcons "alert-circle" size 24 color="#B45309"
   - Warning text: "Your birthday cannot be changed after you complete setup. This helps ensure fair birthday celebrations in your groups."
   - Two buttons:
     - Primary: "Yes, This Is Correct" - calls handleConfirmAndSave
     - Secondary/outline: "Go Back and Edit" - sets step back to 'form'

4. Wrap existing form content in conditional: `{step === 'form' && (...existing content...)}`

5. Add confirmation content: `{step === 'confirm' && (...confirmation UI...)}`

Confirmation UI pattern from research:
```typescript
{step === 'confirm' && (
  <VStack flex={1} padding="$6" space="xl" justifyContent="center">
    <Heading size="2xl" textAlign="center">
      Confirm Your Birthday
    </Heading>

    <Text size="xl" textAlign="center" fontWeight="$semibold">
      {birthday.toLocaleDateString('en-US', {
        month: 'long',
        day: 'numeric',
        year: 'numeric'
      })}
    </Text>

    <View
      style={{
        backgroundColor: '#FEF3C7',
        padding: 16,
        borderRadius: 12,
        borderWidth: 1,
        borderColor: '#FCD34D',
      }}
    >
      <View style={{ flexDirection: 'row', alignItems: 'flex-start' }}>
        <MaterialCommunityIcons name="alert-circle" size={24} color="#B45309" />
        <View style={{ flex: 1, marginLeft: 12 }}>
          <Text style={{ fontWeight: '700', color: '#92400E', marginBottom: 4 }}>
            Important Notice
          </Text>
          <Text style={{ color: '#92400E', fontSize: 14, lineHeight: 20 }}>
            Your birthday cannot be changed after you complete setup.
            This helps ensure fair birthday celebrations in your groups.
          </Text>
        </View>
      </View>
    </View>

    <VStack space="md" marginTop="$4">
      <Button size="lg" onPress={handleConfirmAndSave} isDisabled={isLoading}>
        <ButtonText>{isLoading ? 'Saving...' : 'Yes, This Is Correct'}</ButtonText>
      </Button>
      <Button variant="outline" size="lg" onPress={() => setStep('form')}>
        <ButtonText>Go Back and Edit</ButtonText>
      </Button>
    </VStack>
  </VStack>
)}
```

Note: Use React Native View/Text for the warning box styling since Gluestack Box may not support all style props consistently. The Heading, Button components work fine from Gluestack.
  </action>
  <verify>
    - `grep -l "cannot be changed" app/(onboarding)/index.tsx` returns the file
    - `grep -l "Confirm Your Birthday" app/(onboarding)/index.tsx` returns the file
    - `grep -l "Go Back and Edit" app/(onboarding)/index.tsx` returns the file
    - `npx tsc --noEmit` passes without type errors
  </verify>
  <done>
    - Onboarding has two steps: form entry and birthday confirmation
    - Continue button on form validates fields and shows confirmation
    - Confirmation step displays birthday prominently
    - Warning box with amber styling explains birthday is permanent
    - "Yes, This Is Correct" saves profile and navigates to app
    - "Go Back and Edit" returns to form step
    - Save only happens after explicit confirmation
  </done>
</task>

</tasks>

<verification>
1. App builds without errors: `npx expo start` launches successfully
2. Onboarding flow works end-to-end:
   - User enters name, picks birthday, uploads optional avatar
   - Tapping Continue shows confirmation step
   - Confirmation shows formatted birthday prominently
   - Warning box visible with amber styling and alert icon
   - Warning text explains birthday cannot be changed
   - "Go Back and Edit" returns to form with data preserved
   - "Yes, This Is Correct" saves and navigates to main app
3. Only the final confirmation triggers database save
</verification>

<success_criteria>
- [ ] Onboarding shows confirmation step before saving
- [ ] Birthday displayed in human-readable format (e.g., "February 15, 1990")
- [ ] Warning box clearly visible with amber/warning colors
- [ ] Warning text explains birthday permanence
- [ ] User can go back to edit before confirming
- [ ] Profile only saves after explicit confirmation
- [ ] TypeScript types pass
</success_criteria>

<output>
After completion, create `.planning/phases/07-profile-editing/07-02-SUMMARY.md`
</output>
