---
phase: 07-profile-editing
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/(app)/settings/_layout.tsx
  - app/(app)/settings/profile.tsx
  - app/(app)/(tabs)/index.tsx
autonomous: true

must_haves:
  truths:
    - "User can edit their display name from profile settings"
    - "User can change their profile photo from profile settings"
    - "User sees birthday field as locked/read-only in profile settings"
  artifacts:
    - path: "app/(app)/settings/_layout.tsx"
      provides: "Stack navigation layout for settings screens"
      min_lines: 10
    - path: "app/(app)/settings/profile.tsx"
      provides: "Profile editing screen with name, photo, and locked birthday"
      min_lines: 80
    - path: "app/(app)/(tabs)/index.tsx"
      provides: "Home screen with gear icon for settings access"
      contains: "settings/profile"
  key_links:
    - from: "app/(app)/(tabs)/index.tsx"
      to: "app/(app)/settings/profile.tsx"
      via: "router.push navigation"
      pattern: "router\\.push.*settings/profile"
    - from: "app/(app)/settings/profile.tsx"
      to: "lib/storage.ts"
      via: "uploadAvatar import"
      pattern: "import.*uploadAvatar.*from.*storage"
    - from: "app/(app)/settings/profile.tsx"
      to: "supabase user_profiles"
      via: "update query"
      pattern: "supabase.*from.*user_profiles.*update"
---

<objective>
Create profile settings screen where users can edit their display name and profile photo, with birthday shown as locked/read-only.

Purpose: Fulfills PROF-01, PROF-02, PROF-03 requirements - users need the ability to update their profile after onboarding while understanding birthday is permanent.

Output: New settings route with profile editing screen, accessible via gear icon in Home header.
</objective>

<execution_context>
@/home/zetaz/.claude/get-shit-done/workflows/execute-plan.md
@/home/zetaz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-profile-editing/07-RESEARCH.md

# Existing patterns to reuse
@lib/storage.ts
@app/(onboarding)/index.tsx
@app/(app)/_layout.tsx
@app/(app)/(tabs)/index.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create settings layout and profile editing screen</name>
  <files>
    app/(app)/settings/_layout.tsx
    app/(app)/settings/profile.tsx
  </files>
  <action>
Create the settings stack navigator and profile editing screen:

1. Create `app/(app)/settings/_layout.tsx`:
   - Stack navigator with modal presentation
   - Screen options for profile with "Edit Profile" title
   - Use existing header style patterns (burgundy tint: #8B1538)

2. Create `app/(app)/settings/profile.tsx`:
   - Load current user profile on mount via supabase.from('user_profiles').select('*').eq('id', user.id).single()
   - Display editable Avatar using existing uploadAvatar/getAvatarUrl from lib/storage.ts
   - Display editable Input for display_name
   - Display LOCKED birthday field:
     - Use Box component with gray background ($backgroundLight100)
     - Show formatted date using date-fns format()
     - Include lock icon (MaterialCommunityIcons "lock")
     - Add helper text: "Birthday cannot be changed after initial setup"
   - Save button updates user_profiles (display_name and avatar_url only)
   - Show success/error Alert on save
   - Use Gluestack components: VStack, HStack, Text, Input, InputField, Avatar, AvatarImage, AvatarFallbackText, Button, ButtonText, Pressable, Box, Heading
   - Add cache-busting timestamp to avatar URL: `getAvatarUrl(path) + '?t=' + Date.now()`

Pattern from research - Locked birthday field:
```typescript
<VStack space="xs">
  <HStack alignItems="center" space="xs">
    <Text fontWeight="$medium" color="$textLight700">Birthday</Text>
    <MaterialCommunityIcons name="lock" size={14} color="#9CA3AF" />
  </HStack>
  <Box
    backgroundColor="$backgroundLight100"
    borderRadius="$md"
    padding="$3"
    borderWidth={1}
    borderColor="$borderLight200"
  >
    <Text color="$textLight600">{format(new Date(profile.birthday), 'MMMM d, yyyy')}</Text>
  </Box>
  <Text fontSize="$xs" color="$textLight500">
    Birthday cannot be changed after initial setup
  </Text>
</VStack>
```
  </action>
  <verify>
    - `ls app/(app)/settings/` shows _layout.tsx and profile.tsx
    - `grep -l "uploadAvatar" app/(app)/settings/profile.tsx` returns the file
    - `grep -l "lock" app/(app)/settings/profile.tsx` returns the file (birthday is locked)
    - `npx tsc --noEmit` passes without errors in these files
  </verify>
  <done>
    - Settings layout exists with stack navigation
    - Profile screen displays current profile data
    - Display name is editable and saveable
    - Avatar is changeable via tap (reuses uploadAvatar)
    - Birthday shows as locked with lock icon and helper text
    - Save updates user_profiles table
  </done>
</task>

<task type="auto">
  <name>Task 2: Add settings entry point to Home screen</name>
  <files>
    app/(app)/(tabs)/index.tsx
    app/(app)/_layout.tsx
  </files>
  <action>
Add gear icon to Home screen header and register settings route:

1. Modify `app/(app)/_layout.tsx`:
   - Add Stack.Screen for "settings/profile" with modal presentation
   - Set header title "Edit Profile"
   - Match existing header style (backgroundColor: '#ffffff', tintColor: '#8B1538')

2. Modify `app/(app)/(tabs)/index.tsx`:
   - Import useRouter from expo-router (already imported)
   - Add TouchableOpacity with gear icon in the header area (top-right of gradient header)
   - Icon: MaterialCommunityIcons "cog" size 24, color white
   - onPress: router.push('/settings/profile')
   - Position absolute in top-right of gradient header area (right: spacing.lg, top: 60)

The gear icon goes inside the LinearGradient header, positioned top-right:
```typescript
<TouchableOpacity
  style={{
    position: 'absolute',
    right: spacing.lg,
    top: 60,
    padding: spacing.sm,
  }}
  onPress={() => router.push('/settings/profile' as any)}
>
  <MaterialCommunityIcons name="cog" size={24} color={colors.white} />
</TouchableOpacity>
```
  </action>
  <verify>
    - `grep -l "settings/profile" app/(app)/_layout.tsx` returns the file
    - `grep -l "cog" app/(app)/(tabs)/index.tsx` returns the file
    - `npx tsc --noEmit` passes without type errors
  </verify>
  <done>
    - Gear icon visible in Home screen header (top-right, white)
    - Tapping gear navigates to profile settings screen
    - Settings route registered in app layout with modal presentation
  </done>
</task>

</tasks>

<verification>
1. App builds without errors: `npx expo start` launches successfully
2. Home screen shows gear icon in top-right of header
3. Tapping gear opens profile settings as modal
4. Profile settings shows:
   - Current avatar (tappable to change)
   - Editable display name field
   - Locked birthday with lock icon and "cannot be changed" text
5. Changing avatar immediately uploads to Supabase Storage
6. Saving display name updates database
7. Birthday field is not editable (no keyboard, no tap response)
</verification>

<success_criteria>
- [ ] Settings route exists at app/(app)/settings/
- [ ] Profile screen loads and displays current user data
- [ ] Display name can be edited and saved
- [ ] Avatar can be changed (uses existing uploadAvatar)
- [ ] Birthday displays as locked with visual distinction
- [ ] Entry point (gear icon) visible on Home screen
- [ ] Navigation from Home to settings works
- [ ] All TypeScript types pass
</success_criteria>

<output>
After completion, create `.planning/phases/07-profile-editing/07-01-SUMMARY.md`
</output>
