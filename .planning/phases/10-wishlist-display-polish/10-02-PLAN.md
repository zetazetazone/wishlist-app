---
phase: 10-wishlist-display-polish
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - components/wishlist/LuxuryWishlistCard.tsx
  - app/(app)/(tabs)/wishlist.tsx
  - components/ui/StarRating.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "User can tap any star on a wishlist item card to change its priority"
    - "Priority changes persist to database immediately"
    - "Stars are large enough for comfortable mobile tapping (32-40px)"
  artifacts:
    - path: "components/wishlist/LuxuryWishlistCard.tsx"
      provides: "Interactive star rating with onPriorityChange callback"
      contains: "onPriorityChange"
    - path: "app/(app)/(tabs)/wishlist.tsx"
      provides: "Priority update handler with Supabase update"
      contains: "handlePriorityChange"
    - path: "components/ui/StarRating.tsx"
      provides: "Larger default star size with hit slop"
      contains: "hitSlop"
  key_links:
    - from: "components/wishlist/LuxuryWishlistCard.tsx"
      to: "StarRating"
      via: "onRatingChange prop"
      pattern: "onRatingChange=.*onPriorityChange"
    - from: "app/(app)/(tabs)/wishlist.tsx"
      to: "supabase"
      via: "update call"
      pattern: "supabase.*update.*priority"
---

<objective>
Enable tappable star ratings on wishlist cards with immediate database persistence

Purpose: Users reported stars should be tappable to dynamically change priority. Also requested larger stars for better mobile tap targets.
Output: Interactive star ratings that update priority in real-time with optimistic UI
</objective>

<execution_context>
@/home/zetaz/.claude/get-shit-done/workflows/execute-plan.md
@/home/zetaz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-wishlist-display-polish/10-01-SUMMARY.md
@.planning/phases/10-wishlist-display-polish/10-UAT.md
@.planning/debug/star-rating-tap-priority.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add onPriorityChange prop and wire interactive stars</name>
  <files>
    components/wishlist/LuxuryWishlistCard.tsx
    components/ui/StarRating.tsx
  </files>
  <action>
    1. In LuxuryWishlistCard.tsx:
       - Add `onPriorityChange?: (id: string, priority: number) => void` to LuxuryWishlistCardProps interface
       - Change line 275 from `<StarRating rating={item.priority} readonly size={20} />` to:
         ```tsx
         <StarRating
           rating={item.priority}
           onRatingChange={(newPriority) => onPriorityChange?.(item.id, newPriority)}
           size={36}
         />
         ```
       - Remove `readonly` prop (defaults to false when onRatingChange is provided)

    2. In StarRating.tsx:
       - Change default size from 20 to 36: `size = 36`
       - Add hitSlop to TouchableOpacity for larger touch target:
         ```tsx
         <TouchableOpacity
           key={star}
           onPress={() => handlePress(star)}
           disabled={readonly}
           activeOpacity={0.7}
           hitSlop={{ top: 8, bottom: 8, left: 4, right: 4 }}
         >
         ```
       - This makes each star ~44x52px touch target (36px icon + 8px hitSlop each side)
  </action>
  <verify>
    TypeScript compiles without errors: `npx tsc --noEmit`
    StarRating component accepts onRatingChange and larger size
  </verify>
  <done>
    LuxuryWishlistCard has onPriorityChange prop
    StarRating displays at size 36 with enhanced touch targets
    Stars are NOT readonly in wishlist cards (interactive mode)
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement priority update handler with optimistic UI</name>
  <files>
    app/(app)/(tabs)/wishlist.tsx
  </files>
  <action>
    1. Add handlePriorityChange function after handleDeleteItem (around line 299):
       ```tsx
       const handlePriorityChange = async (itemId: string, newPriority: number) => {
         // Optimistic update
         setItems(prevItems =>
           prevItems.map(item =>
             item.id === itemId ? { ...item, priority: newPriority } : item
           )
         );

         try {
           const { error } = await supabase
             .from('wishlist_items')
             .update({ priority: newPriority })
             .eq('id', itemId);

           if (error) throw error;
         } catch (error) {
           console.error('Error updating priority:', error);
           // Revert optimistic update on error
           await fetchWishlistItems();
           Alert.alert('Error', 'Failed to update priority');
         }
       };
       ```

    2. Pass the handler to LuxuryWishlistCard in the render section (around line 545):
       ```tsx
       <LuxuryWishlistCard
         key={item.id}
         item={item}
         onDelete={handleDeleteItem}
         onPriorityChange={handlePriorityChange}  // ADD THIS LINE
         index={index}
         favoriteGroups={itemFavorites}
         onToggleFavorite={() => handleHeartPress(item)}
         showFavoriteHeart={true}
       />
       ```
  </action>
  <verify>
    App compiles: `npx expo start` (no red screen)
    TypeScript: `npx tsc --noEmit` passes
    Tap star in wishlist card - should update visually
    Check Supabase dashboard - priority value updated in wishlist_items table
  </verify>
  <done>
    handlePriorityChange function exists in wishlist.tsx
    Function performs optimistic update then Supabase update
    Function handles errors with state recovery
    LuxuryWishlistCard receives onPriorityChange prop
    Tapping stars changes priority immediately (optimistic) and persists to DB
  </done>
</task>

</tasks>

<verification>
- [ ] Stars are visually larger (36px vs previous 20px)
- [ ] Tapping a star updates the rating display immediately
- [ ] Database reflects the new priority value
- [ ] Error during update reverts to previous state and shows alert
- [ ] TypeScript compiles without errors
</verification>

<success_criteria>
1. User can tap any star on wishlist cards to change priority (1-5)
2. Stars are 36px size (comfortable for mobile tapping)
3. Priority updates optimistically then persists to Supabase
4. Errors are handled gracefully with state recovery
</success_criteria>

<output>
After completion, create `.planning/phases/10-wishlist-display-polish/10-02-SUMMARY.md`
</output>
