---
phase: 31-root-integration-settings-ui
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/(app)/settings/language.tsx
  - app/(app)/settings/profile.tsx
  - app/(app)/settings/_layout.tsx
autonomous: true

must_haves:
  truths:
    - "User can navigate to language settings from profile settings screen"
    - "User can select English or Spanish from language picker"
    - "Language change takes effect instantly without app restart"
    - "Selected language displays correctly in settings UI"
    - "Language change syncs to both AsyncStorage and Supabase"
  artifacts:
    - path: "app/(app)/settings/language.tsx"
      provides: "Language selection screen with radio card UI"
      min_lines: 80
    - path: "app/(app)/settings/profile.tsx"
      provides: "Navigation link to language settings"
      contains: "router.push('/settings/language')"
    - path: "app/(app)/settings/_layout.tsx"
      provides: "Route registration for language screen"
      contains: "name=\"language\""
  key_links:
    - from: "app/(app)/settings/profile.tsx"
      to: "/settings/language"
      via: "router.push"
      pattern: "router\\.push.*settings/language"
    - from: "app/(app)/settings/language.tsx"
      to: "useLanguage hook"
      via: "changeLanguage call"
      pattern: "changeLanguage\\(lang"
    - from: "app/(app)/settings/language.tsx"
      to: "auth session"
      via: "userId for server sync"
      pattern: "supabase\\.auth\\.getUser"
---

<objective>
Create language settings UI with instant language switching

Purpose: Complete the v1.5 localization user experience by providing a language selector in profile settings. Users can navigate to a dedicated language screen and switch between English and Spanish with instant UI updates across the app.

Output: Language settings screen, navigation link in profile settings, route registration
</objective>

<execution_context>
@/home/zetaz/.claude/get-shit-done/workflows/execute-plan.md
@/home/zetaz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/31-root-integration-settings-ui/31-RESEARCH.md

# Phase 30 foundation (useLanguage hook, translations)
@hooks/useLanguage.ts
@lib/language.ts
@src/i18n/locales/en.json

# Existing patterns to follow
@app/(app)/settings/profile.tsx
@app/(app)/settings/_layout.tsx
@constants/theme.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create language settings screen</name>
  <files>app/(app)/settings/language.tsx</files>
  <action>
Create language settings screen with radio card selection UI:

1. Create `app/(app)/settings/language.tsx` with:
   - Import useLanguage hook from '@/hooks/useLanguage'
   - Import useTranslation for t() function
   - Import supabase for auth.getUser() to get userId
   - Import theme constants (colors, spacing, borderRadius)

2. Define LANGUAGES array with:
   - { code: 'en', nativeName: 'English', englishName: 'English' }
   - { code: 'es', nativeName: 'Espanol', englishName: 'Spanish' }

3. Component structure:
   - useState for userId (load via supabase.auth.getUser on mount)
   - useLanguage(userId) for currentLanguage, changeLanguage, isLoading
   - useTranslation() for t() function
   - Stack.Screen options with title: t('settings.language')

4. Render:
   - Description text using t('settings.languageDescription')
   - Map LANGUAGES to TouchableOpacity cards with:
     - Radio indicator (outer circle + inner fill when selected)
     - Native name (bold, larger)
     - English name (smaller, muted color)
     - Check icon when selected
     - Selected state: burgundy border, light burgundy background
   - Disable cards during isLoading

5. Handle language selection:
   - If same as current or isLoading, return early
   - Call changeLanguage(lang.code)
   - UI auto-updates via react-i18next bindI18n

Style following theme.ts patterns:
- Container: cream[50] background, lg padding
- Cards: white background, md border radius, sm margin-bottom
- Selected card: burgundy[400] border, burgundy[50] background
- Radio: burgundy[300] border, burgundy[600] fill
- Text: burgundy[900] for native name, cream[600] for english name
  </action>
  <verify>
File exists at app/(app)/settings/language.tsx
Contains: useLanguage, useTranslation, supabase.auth.getUser
Contains: changeLanguage function call
Contains: Stack.Screen with dynamic title
TypeScript compiles without errors: `npx tsc --noEmit 2>&1 | head -30`
  </verify>
  <done>
Language settings screen renders with two language options (English, Spanish) as radio cards
Selected language shows visual distinction (burgundy border, background, check icon)
Tapping a different language calls changeLanguage and shows loading state
  </done>
</task>

<task type="auto">
  <name>Task 2: Add navigation link in profile settings</name>
  <files>app/(app)/settings/profile.tsx</files>
  <action>
Add language settings navigation link to profile settings screen:

1. Add import:
   - useTranslation from 'react-i18next'
   - useLanguage from '@/hooks/useLanguage' (for currentLanguage display)

2. In component, add:
   - const { t } = useTranslation()
   - Extract userId from existing profile load (user.id)
   - const { currentLanguage } = useLanguage(userId) after profile loads

3. Add new Pressable block after "Important Dates" link (before Save Button):

```tsx
{/* Language Settings Link */}
<Pressable
  onPress={() => router.push('/settings/language')}
>
  <Box
    backgroundColor="$white"
    borderRadius="$lg"
    padding="$4"
    borderWidth={1}
    borderColor="$borderLight200"
  >
    <HStack justifyContent="space-between" alignItems="center">
      <VStack>
        <Text fontWeight="$semibold">{t('settings.language')}</Text>
        <Text fontSize="$xs" color="$textLight500">
          {t(`languages.${currentLanguage}`)}
        </Text>
      </VStack>
      <HStack alignItems="center" space="sm">
        <MaterialCommunityIcons name="translate" size={20} color="#8B1538" />
        <MaterialCommunityIcons name="chevron-right" size={20} color="#9CA3AF" />
      </HStack>
    </HStack>
  </Box>
</Pressable>
```

Note: userId should be extracted from the existing getUser call in loadProfile, store in state for useLanguage. If not feasible, initialize useLanguage without userId for read-only access to currentLanguage (sufficient for display).
  </action>
  <verify>
File contains: router.push('/settings/language')
File contains: t('settings.language')
File contains: t(`languages.${currentLanguage}`)
TypeScript compiles without errors: `npx tsc --noEmit 2>&1 | head -30`
  </verify>
  <done>
Profile settings screen shows "Language" link with translate icon
Link displays current language name (e.g., "English" or "Spanish")
Tapping link navigates to /settings/language
  </done>
</task>

<task type="auto">
  <name>Task 3: Register language route in settings layout</name>
  <files>app/(app)/settings/_layout.tsx</files>
  <action>
Add language screen route to settings stack layout:

1. Add new Stack.Screen for language after existing screens:

```tsx
<Stack.Screen
  name="language"
  options={{
    title: 'Language', // Placeholder, overridden by screen's Stack.Screen options
  }}
/>
```

The title is a placeholder because the actual screen (language.tsx) sets its own dynamic title using t('settings.language') via Stack.Screen options.
  </action>
  <verify>
File contains: name="language"
Route accessible: The app should compile and language route should be navigable
TypeScript compiles without errors: `npx tsc --noEmit 2>&1 | head -30`
  </verify>
  <done>
Settings layout registers /settings/language route
Language screen accessible via navigation from profile settings
  </done>
</task>

</tasks>

<verification>
After all tasks complete, verify:

1. TypeScript compilation:
   ```bash
   npx tsc --noEmit
   ```

2. App starts without errors:
   ```bash
   npx expo start --clear
   ```

3. Manual verification flow:
   - Open app, navigate to profile settings
   - See "Language" link with current language displayed
   - Tap to open language settings screen
   - See English and Spanish as selectable options
   - Current language shows selected state
   - Tap different language
   - UI updates instantly (screen title, description change language)
   - Return to profile settings, link shows new language
</verification>

<success_criteria>
- [ ] Language settings screen exists with radio card UI for English/Spanish
- [ ] Profile settings shows language link with current selection
- [ ] Navigation works: profile -> language screen -> back
- [ ] Language change instant (no app restart required)
- [ ] TypeScript compiles without errors
- [ ] App runs without crashes
</success_criteria>

<output>
After completion, create `.planning/phases/31-root-integration-settings-ui/31-01-SUMMARY.md`
</output>
