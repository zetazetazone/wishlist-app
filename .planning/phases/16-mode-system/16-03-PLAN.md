---
phase: 16-mode-system
plan: 03
type: execute
wave: 2
depends_on: ["16-01"]
files_modified:
  - app/(app)/celebration/[id].tsx
  - lib/celebrations.ts
autonomous: true

must_haves:
  truths:
    - "Greetings mode celebration shows birthday card feel: large profile photo, name, date, countdown"
    - "Greetings mode celebration hides Gift Leader, contributions, wishlists, and chat sections"
    - "Greetings mode celebration shows 'Send a greeting' placeholder button (non-functional)"
    - "Gifts mode celebration shows all existing sections unchanged plus a subtle mode badge"
  artifacts:
    - path: "app/(app)/celebration/[id].tsx"
      provides: "Mode-adaptive celebration page with greetings and gifts layouts"
      contains: "greetings"
    - path: "lib/celebrations.ts"
      provides: "Group mode accessible from celebration detail query"
      contains: "mode"
  key_links:
    - from: "app/(app)/celebration/[id].tsx"
      to: "lib/celebrations.ts"
      via: "getCelebration returns group mode"
      pattern: "group.*mode"
    - from: "app/(app)/celebration/[id].tsx"
      to: "components/groups/GroupModeBadge.tsx"
      via: "mode badge on gifts celebration"
      pattern: "GroupModeBadge"
---

<objective>
Adapt the celebration page to display differently based on group mode (MODE-05). Greetings mode shows a warm birthday card layout; Gifts mode shows existing layout with a subtle mode badge.

Purpose: The celebration page is the core experience for each birthday. In Greetings mode, it should feel like opening a birthday card. In Gifts mode, it keeps the full gift coordination interface.
Output: Celebration page with dual-mode rendering based on the group's mode.
</objective>

<execution_context>
@/home/zetaz/.claude/get-shit-done/workflows/execute-plan.md
@/home/zetaz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-mode-system/16-CONTEXT.md

@app/(app)/celebration/[id].tsx
@lib/celebrations.ts
@components/groups/GroupModeBadge.tsx
@constants/theme.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add group mode to celebration detail query</name>
  <files>lib/celebrations.ts</files>
  <action>
    Update the getCelebration function in lib/celebrations.ts to include the group's mode field in the response.

    1. Update the CelebrationDetail interface: change the `group` field from `{ id: string; name: string }` to `{ id: string; name: string; mode?: 'greetings' | 'gifts' }`. Also update the Celebration interface's group field similarly.

    2. In the getCelebration function, the query already selects `groups (id, name)` on ~line 479. Change this to `groups (id, name, mode)` so the mode field is included in the response.

    3. The returned object already maps `group: (celebration as any).groups` on line 609, so the mode will automatically be included once the select query includes it.

    No changes needed to getCelebrations (list query) since that function is used for the celebrations list screen which doesn't need per-group mode rendering.
  </action>
  <verify>
    TypeScript compiles: `npx tsc --noEmit --pretty 2>&1 | head -20`
    getCelebration returns group.mode in the response.
  </verify>
  <done>getCelebration returns the group's mode field, enabling the celebration page to adapt rendering based on mode.</done>
</task>

<task type="auto">
  <name>Task 2: Implement dual-mode celebration page rendering</name>
  <files>app/(app)/celebration/[id].tsx</files>
  <action>
    Import GroupModeBadge from components/groups/GroupModeBadge. Import the colors and spacing from constants/theme if not already imported.

    Determine the group mode from `celebration.group?.mode || 'gifts'` (default to gifts for backward compatibility with existing celebrations).

    **Store as a derived constant:**
    ```typescript
    const groupMode = celebration?.group?.mode || 'gifts';
    const isGreetingsMode = groupMode === 'greetings';
    ```

    **GREETINGS MODE layout (isGreetingsMode === true):**

    Replace the entire info view (the viewMode === 'info' branch) with a greetings-specific layout when isGreetingsMode is true. Also hide the Info/Chat view toggle entirely in greetings mode (since there is no chat coordination in greetings mode).

    The greetings layout should be a single ScrollView containing:

    1. **Birthday Card Header** (larger, warmer feel than the current header):
       - Large celebrant avatar: 120x120 circle (bigger than current 80x80)
       - Celebrant name in large text (28px, bold, burgundy[800])
       - Birthday date with calendar icon
       - Group name with group icon
       - Birthday countdown: large text showing days until birthday in gold[600] with cake icon
       - Status badge (same as existing)
       - Use a warm white (#fff) card with rounded corners (20px), larger padding (32px)

    2. **Birthday message area:**
       - A warm, centered text: "Wishing [name] a wonderful birthday!" in 16px, italic, burgundy[400]

    3. **Send a Greeting placeholder button:**
       - Full-width button below the message area
       - Gold[600] background, white text, "Send a Greeting" label
       - party-popper icon on the left
       - borderRadius.lg, padding spacing.md
       - onPress: Alert.alert("Coming Soon", "Greeting messages will be available in a future update!")
       - This is the future feature hook per CONTEXT.md

    4. **Group chat preview card** (keep this -- members can still chat in greetings mode for coordination):
       - Same chat preview card as existing (lines 598-610)

    **GIFTS MODE layout (isGreetingsMode === false):**

    Keep the ENTIRE existing layout unchanged. Add one small addition:

    - In the header card section (inside the headerCard View, after the status badge ~line 388), add a subtle GroupModeBadge: `<View style={{ marginTop: 8 }}><GroupModeBadge mode="gifts" /></View>`

    **View toggle hiding:**
    Only show the Info/Chat view toggle when NOT in greetings mode. In greetings mode, hide the toggle bar entirely and always show the greetings layout (no chat tab needed since there's no gift coordination to discuss, though the chat preview card at the bottom still lets them access it).

    WAIT -- the CONTEXT.md says greetings mode hides "Gift Leader, contributions" but does NOT say hide chat. Chat is a general coordination tool. So in greetings mode, still show the Info/Chat toggle but:
    - The "Info" tab shows the greetings birthday card layout (no gift leader, no contributions, no wishlists)
    - The "Chat" tab still works as before

    This is cleaner: greetings mode changes the INFO content, not the navigation structure.

    **Implementation approach:**
    In the `viewMode === 'info'` branch (line 347), wrap the ScrollView content in a conditional:

    ```tsx
    {viewMode === 'info' ? (
      <ScrollView ...>
        {isGreetingsMode ? (
          {/* Greetings birthday card layout */}
        ) : (
          {/* Existing gifts layout - ALL current sections unchanged */}
        )}
      </ScrollView>
    ) : (
      {/* Chat view - unchanged */}
    )}
    ```
  </action>
  <verify>
    TypeScript compiles: `npx tsc --noEmit --pretty 2>&1 | head -30`
    Celebration page renders different content based on group mode.
    "Send a Greeting" button shows "Coming Soon" alert on press.
    Gifts mode shows GroupModeBadge in header.
    Greetings mode hides Gift Leader, Contributions, and Wishlist sections.
  </verify>
  <done>
    Celebration page adapts to group mode:
    - Greetings: birthday card feel with large photo, countdown, warm message, and "Send a Greeting" placeholder
    - Gifts: existing layout unchanged with subtle mode badge added
    - Chat remains accessible in both modes
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes (or shows only pre-existing errors)
2. lib/celebrations.ts getCelebration query includes `groups (id, name, mode)`
3. CelebrationDetail interface includes mode in group field
4. Celebration page shows greetings layout for greetings-mode groups
5. Celebration page shows existing layout (with badge) for gifts-mode groups
6. "Send a Greeting" button shows coming soon alert
</verification>

<success_criteria>
- Greetings mode celebration: birthday card feel with large photo, name, date, countdown (MODE-05)
- Greetings mode celebration: NO wishlists, NO Gift Leader section, NO contributions section
- Greetings mode celebration: "Send a Greeting" placeholder button present and shows coming soon alert
- Gifts mode celebration: identical to current with added GroupModeBadge in header
- Chat accessible in both modes
- No regression to existing gifts mode celebration functionality
</success_criteria>

<output>
After completion, create `.planning/phases/16-mode-system/16-03-SUMMARY.md`
</output>
