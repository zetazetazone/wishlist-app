---
phase: 19-gift-claims-ui
plan: 02
type: execute
wave: 2
depends_on: ["19-01"]
files_modified:
  - components/wishlist/LuxuryWishlistCard.tsx
autonomous: true

must_haves:
  truths:
    - "Card can render ClaimButton when claimable prop provided"
    - "Card can render TakenBadge when isTaken prop is true"
    - "Card can render ClaimerAvatar when claim prop has claimer data"
    - "Card can render YourClaimIndicator when isYourClaim is true"
    - "Card dims when dimmed prop is true (celebrant taken view)"
    - "Claim button hidden for surprise_me and mystery_box items"
  artifacts:
    - path: "components/wishlist/LuxuryWishlistCard.tsx"
      provides: "Extended wishlist card with claim display capabilities"
      exports: ["default"]
  key_links:
    - from: "components/wishlist/LuxuryWishlistCard.tsx"
      to: "components/wishlist/ClaimButton.tsx"
      via: "import"
      pattern: "import.*ClaimButton.*from"
    - from: "components/wishlist/LuxuryWishlistCard.tsx"
      to: "components/wishlist/TakenBadge.tsx"
      via: "import"
      pattern: "import.*TakenBadge.*from"
---

<objective>
Extend LuxuryWishlistCard with optional claim-related props to support all visual states: claimable, claimed by other, your claim, and celebrant taken view.

Purpose: Single card abstraction handles all claim scenarios without creating separate card variants.
Output: LuxuryWishlistCard.tsx updated with claim props, ready for integration in celebration and wishlist screens.
</objective>

<execution_context>
@/home/zetaz/.claude/get-shit-done/workflows/execute-plan.md
@/home/zetaz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/19-gift-claims-ui/19-CONTEXT.md
@.planning/phases/19-gift-claims-ui/19-RESEARCH.md
@.planning/phases/19-gift-claims-ui/19-01-SUMMARY.md

# Source files
@components/wishlist/LuxuryWishlistCard.tsx
@lib/claims.ts
@types/database.types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add claim-related props to LuxuryWishlistCard interface</name>
  <files>components/wishlist/LuxuryWishlistCard.tsx</files>
  <action>
Import the new claim components at the top of the file:
```typescript
import { ClaimButton } from './ClaimButton';
import { ClaimerAvatar } from './ClaimerAvatar';
import { TakenBadge } from './TakenBadge';
import { YourClaimIndicator } from './YourClaimIndicator';
import type { ClaimWithUser } from '../../lib/claims';
```

Extend LuxuryWishlistCardProps interface with these optional props:
```typescript
// Claim-related props (all optional to maintain backward compatibility)
claimable?: boolean;           // Show claim button (non-celebrant view of unclaimed item)
onClaim?: () => void;          // Called when user taps Claim
onUnclaim?: () => void;        // Called when user taps Unclaim
claiming?: boolean;            // Loading state during claim operation
claim?: ClaimWithUser | null;  // Claim data (null = unclaimed, has data = claimed)
isYourClaim?: boolean;         // Current user owns this claim
isTaken?: boolean;             // Celebrant view: item is claimed (no claimer identity)
dimmed?: boolean;              // Visual dim for taken items (celebrant view)
```

The props enable these scenarios:
1. **My Wishlist (celebrant)**: isTaken + dimmed (no claimable, claim, isYourClaim)
2. **Celebration (unclaimed)**: claimable + onClaim + claiming
3. **Celebration (claimed by other)**: claim (with claimer data)
4. **Celebration (your claim)**: claim + isYourClaim + onUnclaim
  </action>
  <verify>
TypeScript interface compiles: `npx tsc --noEmit 2>&1 | grep LuxuryWishlistCard || echo "No type errors"`
  </verify>
  <done>
Props interface extended with claim-related optional props.
Imports added for all claim components.
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement claim UI rendering in card component</name>
  <files>components/wishlist/LuxuryWishlistCard.tsx</files>
  <action>
Add destructuring for new props in component function parameters.

1. **Dimmed styling for celebrant taken view**:
Wrap the main View container with conditional opacity:
```typescript
style={{
  ...existing styles,
  opacity: dimmed ? 0.6 : 1,  // Per CONTEXT: "Taken items appear dimmed/faded"
}}
```

2. **TakenBadge for celebrant view**:
Add to the header row (next to title or in actions area):
```typescript
{isTaken && <TakenBadge style={{ marginRight: spacing.xs }} />}
```

3. **YourClaimIndicator for your claim**:
Add below the MostWantedBadge area (similar positioning):
```typescript
{isYourClaim && <YourClaimIndicator />}
```

4. **ClaimerAvatar for claimed items (non-celebrant)**:
Add to the actions row (right side of header):
```typescript
{claim?.claimer && !isYourClaim && (
  <ClaimerAvatar claimer={claim.claimer} />
)}
```

5. **ClaimButton for claimable items**:
Add as a new button row below the existing "View Product" button area, OR replace/supplement it based on card state:
- If claimable AND item.item_type === 'standard':
```typescript
{claimable && !isSpecialItem && (
  <View style={{ paddingHorizontal: spacing.md, paddingBottom: spacing.md }}>
    <ClaimButton
      onClaim={onClaim || (() => {})}
      onUnclaim={onUnclaim || (() => {})}
      isClaimed={!!claim}
      isYourClaim={isYourClaim || false}
      loading={claiming || false}
      disabled={isSpecialItem}  // Hide for surprise_me/mystery_box
    />
  </View>
)}
```

6. **Unclaim button for your claims**:
Same ClaimButton handles this via isYourClaim prop - when true, it shows "Unclaim" variant.

Position decisions (Claude's discretion per CONTEXT):
- TakenBadge: Top-right of card header (next to delete button area)
- ClaimerAvatar: Right side of header row, before delete button if present
- YourClaimIndicator: Below MostWantedBadge, above title
- ClaimButton: Below the View Product button (separate row)

Ensure all additions are conditional and don't break existing card usage (all claim props optional).
  </action>
  <verify>
TypeScript compiles: `npx tsc --noEmit`
Card still renders without claim props: Test by checking existing usages don't error.
  </verify>
  <done>
LuxuryWishlistCard renders claim UI based on provided props.
Existing card usages (without claim props) continue to work unchanged.
TakenBadge, ClaimerAvatar, YourClaimIndicator, ClaimButton render in appropriate positions.
Special items (surprise_me, mystery_box) never show claim button.
  </done>
</task>

</tasks>

<verification>
Card file updated with all claim props:
```bash
grep -E "(claimable|onClaim|onUnclaim|claiming|claim\?|isYourClaim|isTaken|dimmed)" components/wishlist/LuxuryWishlistCard.tsx | head -20
```

Imports present:
```bash
grep -E "import.*(ClaimButton|ClaimerAvatar|TakenBadge|YourClaimIndicator)" components/wishlist/LuxuryWishlistCard.tsx
```

TypeScript clean:
```bash
npx tsc --noEmit
```
</verification>

<success_criteria>
- LuxuryWishlistCardProps includes all claim-related optional props
- Card conditionally renders TakenBadge when isTaken is true
- Card conditionally renders ClaimerAvatar when claim.claimer exists
- Card conditionally renders YourClaimIndicator when isYourClaim is true
- Card conditionally renders ClaimButton when claimable is true and item is standard type
- Card applies dimmed opacity when dimmed is true
- All existing card usages continue to work (backward compatible)
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/19-gift-claims-ui/19-02-SUMMARY.md`
</output>
