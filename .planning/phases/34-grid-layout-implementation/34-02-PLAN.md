---
phase: 34-grid-layout
plan: 02
type: execute
wave: 2
depends_on: ["34-01"]
files_modified:
  - components/wishlist/WishlistGrid.tsx
  - components/wishlist/index.ts
autonomous: true

must_haves:
  truths:
    - "FlashList renders items in 2-column masonry layout"
    - "Grid uses virtualization for 60fps scrolling"
    - "Grid supports pull-to-refresh"
    - "Grid shows empty state when no items"
  artifacts:
    - path: "components/wishlist/WishlistGrid.tsx"
      provides: "FlashList masonry grid wrapper"
      min_lines: 80
      exports: ["WishlistGrid"]
  key_links:
    - from: "components/wishlist/WishlistGrid.tsx"
      to: "@shopify/flash-list"
      via: "import { FlashList }"
      pattern: "from '@shopify/flash-list'"
    - from: "components/wishlist/WishlistGrid.tsx"
      to: "components/wishlist/WishlistGridCard.tsx"
      via: "renderItem using WishlistGridCard"
      pattern: "WishlistGridCard"
---

<objective>
Create WishlistGrid component wrapping FlashList with masonry configuration.

Purpose: Encapsulate FlashList masonry setup, renderItem logic, and refresh handling so both My Wishlist and celebration page can use the same grid component with consistent layout.

Output: `components/wishlist/WishlistGrid.tsx` - reusable masonry grid component
</objective>

<execution_context>
@/home/zetaz/.claude/get-shit-done/workflows/execute-plan.md
@/home/zetaz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Plan 01 output
@components/wishlist/WishlistGridCard.tsx

# Research - FlashList configuration
@.planning/phases/34-grid-layout-implementation/34-RESEARCH.md

# Phase 33 types
@components/wishlist/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create WishlistGrid component</name>
  <files>components/wishlist/WishlistGrid.tsx</files>
  <action>
Create `components/wishlist/WishlistGrid.tsx` following the research pattern in 34-RESEARCH.md.

**Props interface** (WishlistGridProps):
```typescript
interface WishlistGridProps {
  items: WishlistItem[];
  onItemPress: (item: WishlistItem) => void;
  onItemAction: (item: WishlistItem) => void;

  // View context
  isOwner: boolean;  // True = My Wishlist (owner context), False = celebration page

  // Celebrant view (isOwner=false, isCelebrant=true)
  isCelebrant?: boolean;
  claimStatuses?: Map<string, boolean>;  // Item ID -> isTaken

  // Non-celebrant view (isOwner=false, isCelebrant=false)
  claims?: Map<string, ClaimWithUser>;  // Item ID -> claim data
  currentUserId?: string;  // For determining isYourClaim

  // Favorite state
  favoriteItemIds?: Set<string>;

  // Refresh
  refreshing?: boolean;
  onRefresh?: () => void;

  // Empty state
  ListEmptyComponent?: React.ReactElement;
}
```

**Component implementation:**

1. **FlashList configuration:**
   - `masonry` prop enabled (v2 feature)
   - `numColumns={2}`
   - `optimizeItemArrangement` (default true, reduces column height differences)
   - `keyExtractor={(item) => item.id}` (NOT index)
   - NO `estimatedItemSize` (v2 auto-measures)

2. **contentContainerStyle:**
   - `paddingHorizontal: spacing.md` (16px)
   - `paddingTop: spacing.md`
   - `paddingBottom: 100` (space for FAB)

3. **renderItem** (useCallback for optimization):
   ```typescript
   const renderItem = useCallback(({ item, index }: { item: WishlistItem; index: number }) => {
     // Determine view context
     const isFavorite = favoriteItemIds?.has(item.id) ?? false;

     // Celebrant view
     if (isCelebrant) {
       const isTaken = claimStatuses?.get(item.id) ?? false;
       return (
         <WishlistGridCard
           item={item}
           onPress={() => onItemPress(item)}
           onActionPress={() => onItemAction(item)}
           index={index}
           isFavorite={isFavorite}
           isTaken={isTaken}
         />
       );
     }

     // Non-celebrant view (group member viewing celebration)
     if (!isOwner && !isCelebrant) {
       const claim = claims?.get(item.id) ?? null;
       const isYourClaim = claim?.claimer?.id === currentUserId;
       return (
         <WishlistGridCard
           item={item}
           onPress={() => onItemPress(item)}
           onActionPress={() => onItemAction(item)}
           index={index}
           isFavorite={isFavorite}
           claim={claim}
           isYourClaim={isYourClaim}
         />
       );
     }

     // Owner view (My Wishlist)
     return (
       <WishlistGridCard
         item={item}
         onPress={() => onItemPress(item)}
         onActionPress={() => onItemAction(item)}
         index={index}
         isFavorite={isFavorite}
       />
     );
   }, [/* dependencies */]);
   ```

4. **RefreshControl** (conditional):
   ```typescript
   refreshControl={
     onRefresh ? (
       <RefreshControl
         refreshing={refreshing ?? false}
         onRefresh={onRefresh}
         tintColor={colors.burgundy[600]}
         colors={[colors.burgundy[600]]}
       />
     ) : undefined
   }
   ```

5. **ListEmptyComponent**: Pass through from props

**Import statements:**
```typescript
import { useCallback } from 'react';
import { StyleSheet, RefreshControl } from 'react-native';
import { FlashList } from '@shopify/flash-list';
import { WishlistGridCard } from './WishlistGridCard';
import { colors, spacing } from '@/constants/theme';
import type { WishlistItem } from '@/types/database.types';
import type { ClaimWithUser } from '@/lib/claims';
```

**Export as named export.**
  </action>
  <verify>
```bash
# File exists with content
wc -l components/wishlist/WishlistGrid.tsx  # Should be >80 lines

# TypeScript compiles
npx tsc --noEmit 2>&1 | grep -i "WishlistGrid" || echo "No WishlistGrid errors"

# Check FlashList import
grep "from '@shopify/flash-list'" components/wishlist/WishlistGrid.tsx

# Check masonry prop
grep "masonry" components/wishlist/WishlistGrid.tsx

# Check numColumns
grep "numColumns={2}" components/wishlist/WishlistGrid.tsx

# Verify NO estimatedItemSize (v2 doesn't need it)
grep "estimatedItemSize" components/wishlist/WishlistGrid.tsx && echo "WARNING: estimatedItemSize found" || echo "Correctly omitted estimatedItemSize"

# Check WishlistGridCard usage
grep "WishlistGridCard" components/wishlist/WishlistGrid.tsx
```
  </verify>
  <done>
WishlistGrid.tsx exists with:
- FlashList with masonry prop and numColumns={2}
- NO estimatedItemSize (v2 auto-measures)
- renderItem using WishlistGridCard with correct view context logic
- RefreshControl integration
- ListEmptyComponent pass-through
- No TypeScript errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Update barrel export</name>
  <files>components/wishlist/index.ts</files>
  <action>
Add WishlistGrid to the barrel export in `components/wishlist/index.ts`:

```typescript
export { WishlistGrid } from './WishlistGrid';
```
  </action>
  <verify>
```bash
# Check export exists
grep "WishlistGrid" components/wishlist/index.ts
```
  </verify>
  <done>
WishlistGrid is exported from components/wishlist/index.ts barrel file.
  </done>
</task>

</tasks>

<verification>
**Overall plan verification:**

1. WishlistGrid.tsx exists and compiles:
```bash
ls -la components/wishlist/WishlistGrid.tsx
npx tsc --noEmit 2>&1 | grep -c "error" || echo "0 errors"
```

2. FlashList masonry configuration correct:
```bash
grep "masonry" components/wishlist/WishlistGrid.tsx
grep "numColumns={2}" components/wishlist/WishlistGrid.tsx
grep "optimizeItemArrangement" components/wishlist/WishlistGrid.tsx || echo "Using default"
```

3. No deprecated patterns:
```bash
grep "estimatedItemSize" components/wishlist/WishlistGrid.tsx && echo "WARNING" || echo "OK - no estimatedItemSize"
grep "MasonryFlashList" components/wishlist/WishlistGrid.tsx && echo "WARNING" || echo "OK - using masonry prop"
```

4. Barrel export works:
```bash
grep "WishlistGrid" components/wishlist/index.ts
```
</verification>

<success_criteria>
- [ ] WishlistGrid.tsx exists with >80 lines
- [ ] FlashList used with `masonry` prop (v2 pattern)
- [ ] numColumns={2} configured
- [ ] NO estimatedItemSize (v2 auto-measures)
- [ ] renderItem uses WishlistGridCard with view context logic
- [ ] RefreshControl integrated conditionally
- [ ] ListEmptyComponent passed through
- [ ] TypeScript compiles without new errors
- [ ] Component exported from barrel file
</success_criteria>

<output>
After completion, create `.planning/phases/34-grid-layout-implementation/34-02-SUMMARY.md`
</output>
