---
phase: 34-grid-layout
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - components/wishlist/WishlistGridCard.tsx
autonomous: true

must_haves:
  truths:
    - "Grid card displays item image with expo-image caching"
    - "Grid card displays title truncated to 2 lines"
    - "Grid card displays formatted price"
    - "Grid card shows action button in bottom-right corner"
    - "Special items show placeholder icons instead of images"
    - "Taken items display dimmed with badge (celebrant view)"
  artifacts:
    - path: "components/wishlist/WishlistGridCard.tsx"
      provides: "Grid card component for wishlist items"
      min_lines: 150
      exports: ["WishlistGridCard"]
  key_links:
    - from: "components/wishlist/WishlistGridCard.tsx"
      to: "expo-image"
      via: "import { Image } from 'expo-image'"
      pattern: "from 'expo-image'"
    - from: "components/wishlist/WishlistGridCard.tsx"
      to: "utils/wishlist.ts"
      via: "import { formatItemPrice, getImagePlaceholder }"
      pattern: "from '@/utils/wishlist'"
    - from: "components/wishlist/WishlistGridCard.tsx"
      to: "components/wishlist/types.ts"
      via: "import { WishlistGridCardProps }"
      pattern: "from './types'"
---

<objective>
Create WishlistGridCard component for compact grid display of wishlist items.

Purpose: Build the foundational grid card component that displays item image (with expo-image caching), title, price, and action button. Handles special item types with placeholder icons and celebrant privacy (dimmed/taken state).

Output: `components/wishlist/WishlistGridCard.tsx` - complete grid card component
</objective>

<execution_context>
@/home/zetaz/.claude/get-shit-done/workflows/execute-plan.md
@/home/zetaz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Phase 33 outputs - required imports
@components/wishlist/types.ts
@utils/wishlist.ts

# Research - implementation patterns
@.planning/phases/34-grid-layout-implementation/34-RESEARCH.md

# Feature inventory - prop mapping
@.planning/phases/33-foundation-feature-inventory/FEATURE-INVENTORY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create WishlistGridCard component</name>
  <files>components/wishlist/WishlistGridCard.tsx</files>
  <action>
Create `components/wishlist/WishlistGridCard.tsx` following the research pattern in 34-RESEARCH.md.

**Props interface** (use WishlistGridCardProps from types.ts, extend with onActionPress):
- `item: WishlistItem` - the item data
- `onPress: () => void` - card tap handler (navigates to detail)
- `onActionPress: () => void` - action button handler (opens options/shows claim status)
- `index: number` - for animation delay
- `isFavorite: boolean` - controls border accent
- `isTaken?: boolean` - celebrant view: shows "Taken" badge, dims card
- `claim?: ClaimWithUser | null` - non-celebrant view: claimer avatar
- `isYourClaim?: boolean` - non-celebrant view: "Your Claim" indicator

**Component structure:**

1. **Card container** (Pressable):
   - Use `Pressable` (not TouchableOpacity) for future-proof touch handling
   - Style callback for pressed state: `opacity: 0.9, transform: [{ scale: 0.98 }]`
   - Apply `opacity: 0.6` when `isTaken && dimmed` (celebrant view)
   - Card width calculated: `(SCREEN_WIDTH - spacing.md * 2 - spacing.sm) / 2`
   - White background, borderRadius.md, shadows.sm

2. **Image container**:
   - Square aspect ratio (1:1)
   - If `hasImage` (item.image_url && item.item_type === 'standard'):
     - Use expo-image `<Image>` with:
       - `source={{ uri: item.image_url }}`
       - `recyclingKey={item.id}` (CRITICAL for FlashList)
       - `contentFit="cover"`
       - `cachePolicy="memory-disk"`
       - `placeholder={{ blurhash: 'L6PZfSi_.AyE_3t7t7R**0o#DgR4' }}`
       - `placeholderContentFit="cover"` (must match contentFit)
       - `transition={200}` (200ms crossfade)
   - Else (no image or special item):
     - Use `getImagePlaceholder(item.item_type)` from utils/wishlist.ts
     - Render View with backgroundColor and MaterialCommunityIcons icon

3. **Taken badge** (celebrant view only):
   - Position: absolute, top: 8, right: 8
   - Show when `isTaken === true`
   - White background with 95% opacity, borderRadius.sm
   - Contains check-circle icon + "Taken" text
   - Use colors.success for icon and text

4. **Content section**:
   - Padding: spacing.sm
   - Title: Text with `numberOfLines={2}`, fontSize 14, fontWeight 600, lineHeight 18
   - Price: Text with `formatItemPrice(item)` from utils/wishlist.ts
     - fontSize 14, fontWeight 700, colors.gold[700]

5. **Action button** (bottom-right):
   - Position: absolute, bottom: 8, right: 8
   - 28x28 circle with white background (95% opacity), shadows.sm
   - Inner Pressable with `hitSlop={8}` for larger touch target
   - Icon logic:
     - If owner view (no claim context): `dots-vertical` icon
     - If viewer with claim: `gift` icon (claimed by someone)
     - If `isYourClaim`: `check-circle` icon (your claim)
     - If unclaimed: `gift-outline` icon
   - Icon size 18, color colors.burgundy[600]

**Do NOT include:**
- Animations (handled by parent grid wrapper or future iteration)
- Complex claim/split UI (moves to detail page in Phase 35)
- Options sheet rendering (moves to Phase 36)

**Import statements:**
```typescript
import { View, Text, StyleSheet, Pressable, Dimensions } from 'react-native';
import { Image } from 'expo-image';
import { MaterialCommunityIcons } from '@expo/vector-icons';
import { colors, spacing, borderRadius, shadows } from '@/constants/theme';
import { formatItemPrice, getImagePlaceholder } from '@/utils/wishlist';
import type { WishlistItem } from '@/types/database.types';
import type { ClaimWithUser } from '@/lib/claims';
```

**Export as named export** (not default) per codebase convention for new components.
  </action>
  <verify>
```bash
# File exists with content
wc -l components/wishlist/WishlistGridCard.tsx  # Should be >150 lines

# TypeScript compiles
npx tsc --noEmit 2>&1 | grep -i "WishlistGridCard" || echo "No WishlistGridCard errors"

# Check exports
grep "export function WishlistGridCard" components/wishlist/WishlistGridCard.tsx

# Check expo-image import with recyclingKey
grep "recyclingKey" components/wishlist/WishlistGridCard.tsx

# Check utility imports
grep "from '@/utils/wishlist'" components/wishlist/WishlistGridCard.tsx
```
  </verify>
  <done>
WishlistGridCard.tsx exists with:
- expo-image integration with recyclingKey and blur placeholder
- Title (2-line truncation) and price display using formatItemPrice
- Action button with role-based icon
- Special item placeholder icons via getImagePlaceholder
- Taken badge for celebrant privacy view
- Pressable with pressed state styling
- No TypeScript errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Add WishlistGridCard to barrel export</name>
  <files>components/wishlist/index.ts</files>
  <action>
Check if `components/wishlist/index.ts` exists. If it does, add the WishlistGridCard export. If it doesn't exist, create it with exports for the new component.

If creating new:
```typescript
// components/wishlist/index.ts
export { WishlistGridCard } from './WishlistGridCard';
// Keep existing exports if file exists
```

If file exists, append:
```typescript
export { WishlistGridCard } from './WishlistGridCard';
```

This enables imports like `import { WishlistGridCard } from '@/components/wishlist'`.
  </action>
  <verify>
```bash
# Check export exists
grep "WishlistGridCard" components/wishlist/index.ts || echo "Export not found"

# Verify import works (TypeScript check)
npx tsc --noEmit 2>&1 | grep -i "wishlist/index" || echo "No barrel export errors"
```
  </verify>
  <done>
WishlistGridCard is exported from components/wishlist/index.ts barrel file.
  </done>
</task>

</tasks>

<verification>
**Overall plan verification:**

1. WishlistGridCard.tsx exists and compiles:
```bash
ls -la components/wishlist/WishlistGridCard.tsx
npx tsc --noEmit 2>&1 | grep -c "error" || echo "0 errors"
```

2. Component has required features:
```bash
# expo-image with recyclingKey
grep -c "recyclingKey" components/wishlist/WishlistGridCard.tsx

# formatItemPrice utility
grep "formatItemPrice" components/wishlist/WishlistGridCard.tsx

# getImagePlaceholder utility
grep "getImagePlaceholder" components/wishlist/WishlistGridCard.tsx

# Pressable (not TouchableOpacity)
grep "Pressable" components/wishlist/WishlistGridCard.tsx
grep "TouchableOpacity" components/wishlist/WishlistGridCard.tsx || echo "Correctly avoided TouchableOpacity"
```

3. Barrel export works:
```bash
grep "WishlistGridCard" components/wishlist/index.ts
```
</verification>

<success_criteria>
- [ ] WishlistGridCard.tsx exists with >150 lines
- [ ] expo-image used with recyclingKey, cachePolicy, blur placeholder
- [ ] formatItemPrice and getImagePlaceholder utilities imported and used
- [ ] Pressable used for touch handling (not TouchableOpacity)
- [ ] Action button positioned absolute bottom-right with hitSlop
- [ ] Taken badge renders conditionally for celebrant view
- [ ] TypeScript compiles without new errors
- [ ] Component exported from barrel file
</success_criteria>

<output>
After completion, create `.planning/phases/34-grid-layout-implementation/34-01-SUMMARY.md`
</output>
